<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PROJECT: PLAYCARE – Chapter 1</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:#02030a;
  font-family:Arial, system-ui, sans-serif;
  color:white;
}

/* TITLE SCREEN */
#titleScreen{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:linear-gradient(160deg, #050814 0%, #02030a 40%, #050814 100%);
  z-index:30;
}
#titleBackdrop{
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 20% 20%, rgba(255,0,0,0.08) 0, transparent 45%),
    radial-gradient(circle at 80% 70%, rgba(0,120,255,0.12) 0, transparent 50%);
  pointer-events:none;
  opacity:0.9;
}
#titleContent{
  position:relative;
  text-align:center;
}
#titleLogo{
  margin:0;
  text-transform:uppercase;
  letter-spacing:8px;
}
#titleLogo span:nth-child(1){
  display:block;
  font-size:18px;
  color:#ff4a4a;
}
#titleLogo span:nth-child(2){
  display:block;
  font-size:40px;
}
#titleTagline{
  margin-top:6px;
  font-size:13px;
  opacity:.78;
  animation:tagPulse 2.8s ease-in-out infinite;
}
@keyframes tagPulse{
  0%,100%{opacity:.45;}
  50%{opacity:1;}
}
#titleButtons{
  margin-top:26px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.titleBtn{
  padding:10px 32px;
  font-size:15px;
  letter-spacing:2px;
  text-transform:uppercase;
  border:none;
  border-radius:4px;
  cursor:pointer;
  background:#ff2222;
  color:white;
  box-shadow:0 0 14px rgba(0,0,0,0.5);
  transition:background .15s,transform .1s,box-shadow .15s;
}
.titleBtn:hover{
  background:#ff4444;
  transform:translateY(-1px);
  box-shadow:0 0 22px rgba(255,60,60,0.6);
}

/* SETTINGS PANEL */
#settingsPanel{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:320px;
  padding:16px 18px;
  background:rgba(3,4,10,0.95);
  border:1px solid #444;
  box-shadow:0 0 22px rgba(0,0,0,0.9);
  display:none;
  z-index:35;
}
#settingsPanel h2{
  margin:0 0 10px 0;
  font-size:18px;
  letter-spacing:2px;
}
.settingRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:8px 0;
  font-size:13px;
}
.settingRow input[type=range]{
  width:170px;
}
.settingRow input[type=checkbox]{
  transform:scale(1.1);
}
#settingsClose{
  margin-top:12px;
  padding:6px 14px;
  font-size:13px;
  border:none;
  border-radius:4px;
  background:#444;
  color:white;
  cursor:pointer;
}
#settingsClose:hover{
  background:#666;
}

/* GAME HUD STUBS */
#hud,#info{
  position:absolute;
  left:20px;
  bottom:20px;
  color:white;
  font-size:14px;
  text-shadow:0 0 4px #000;
  z-index:10;
  white-space:pre-line;
  display:none;
}
#info{
  left:auto;
  right:20px;
  bottom:auto;
  top:20px;
  font-size:13px;
  text-align:right;
}
#crosshair{
  position:absolute;
  top:50%;left:50%;
  width:6px;height:6px;
  background:white;
  transform:translate(-50%,-50%);
  display:none;
  z-index:10;
}

/* GAME OVER / CREDITS PLACEHOLDERS */
#gameOver,#credits{
  position:absolute;
  inset:0;
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:black;
  color:white;
  z-index:40;
}
#gameOver h1,#credits h1{
  margin-bottom:10px;
  letter-spacing:4px;
}

/* Jumpscare overlay placeholder */
#jumpscare{
  position:absolute;
  inset:0;
  background:black;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:50;
}
#jumpscare img{
  max-width:100%;
  max-height:100%;
  object-fit:contain;
}

/* Canvas */
#gameCanvas{
  position:fixed;
  inset:0;
  display:block;
  z-index:0;
}
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="titleScreen">
  <div id="titleBackdrop"></div>
  <div id="titleContent">
    <h1 id="titleLogo">
      <span>PROJECT:</span>
      <span>PLAYCARE</span>
    </h1>
    <div id="titleTagline">“Everyone disappeared. They’re still here.”</div>
    <div id="titleButtons">
      <button class="titleBtn" id="playBtn">Play</button>
      <button class="titleBtn" id="settingsBtn">Settings</button>
      <button class="titleBtn" id="quitBtn">Quit</button>
    </div>
  </div>
</div>

<!-- SETTINGS -->
<div id="settingsPanel">
  <h2>SETTINGS</h2>
  <div class="settingRow">
    <span>Master Volume</span>
    <input id="volumeSlider" type="range" min="0" max="100" value="75">
  </div>
  <div class="settingRow">
    <span>Mouse Sensitivity</span>
    <input id="sensSlider" type="range" min="20" max="200" value="80">
  </div>
  <div class="settingRow">
    <span>Flashlight Enabled</span>
    <input id="flashToggle" type="checkbox" checked>
  </div>
  <button id="settingsClose">Back</button>
</div>

<!-- HUD / INFO -->
<div id="hud"></div>
<div id="info"></div>
<div id="crosshair"></div>

<!-- Game over / credits scaffolds (we’ll fill later when chase/exits exist) -->
<div id="gameOver">
  <h1>YOU DIED</h1>
  <p>Huggy found you.\n\nThis will later restart from the lobby.</p>
</div>

<div id="credits">
  <h1>CHAPTER 1 COMPLETE</h1>
  <p>You opened Poppy’s case.\nThanks for playing this web fan demo.</p>
</div>

<div id="jumpscare">
  <!-- <img src="huggy_jumpscare.png" alt="Huggy"> -->
</div>

<!-- AUDIO -->
<audio id="titleMusic" src="Title music.mp3" loop></audio>
<audio id="hallMusic" src="Bgm-1.mp3" loop></audio>
<audio id="chaseMusic" src="chase music.mp3" loop></audio>
<audio id="protoMusic" src="Prototype encounter music.mp3" loop></audio>
<audio id="jumpscareSound" src="jumpscare.mp3"></audio>

<canvas id="gameCanvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
// ===== TITLE + SETTINGS =====
const titleScreen=document.getElementById("titleScreen");
const playBtn=document.getElementById("playBtn");
const settingsBtn=document.getElementById("settingsBtn");
const quitBtn=document.getElementById("quitBtn");
const settingsPanel=document.getElementById("settingsPanel");
const settingsClose=document.getElementById("settingsClose");
const volumeSlider=document.getElementById("volumeSlider");
const sensSlider=document.getElementById("sensSlider");
const flashToggle=document.getElementById("flashToggle");

const titleMusic=document.getElementById("titleMusic");
const hallMusic=document.getElementById("hallMusic");
const chaseMusic=document.getElementById("chaseMusic");
const protoMusic=document.getElementById("protoMusic");

const hud=document.getElementById("hud");
const info=document.getElementById("info");
const crosshair=document.getElementById("crosshair");
const jumpscare=document.getElementById("jumpscare");
const jumpscareSound=document.getElementById("jumpscareSound");

const gameOverUI=document.getElementById("gameOver");
const creditsUI=document.getElementById("credits");

const options={
  masterVolume:0.75,
  mouseSensitivity:0.08, // rad per pixel
  flashlightEnabled:true
};

function fadeIn(audio,target=0.75,duration=1500){
  audio.volume=0;
  audio.play().catch(()=>{});
  const step=target/(duration/50);
  const id=setInterval(()=>{
    audio.volume=Math.min(target,audio.volume+step);
    if(audio.volume>=target)clearInterval(id);
  },50);
}
function fadeOut(audio,duration=1500){
  const step=(audio.volume||0)/(duration/50||1);
  const id=setInterval(()=>{
    audio.volume=Math.max(0,audio.volume-step);
    if(audio.volume<=0){audio.pause();clearInterval(id);}
  },50);
}
function stopAllMusic(){
  [titleMusic,hallMusic,chaseMusic,protoMusic].forEach(a=>{a.pause();a.currentTime=0;});
}
function applyMasterVolume(){
  const list=[titleMusic,hallMusic,chaseMusic,protoMusic];
  list.forEach(a=>{a.volume=options.masterVolume;});
}

// init title music
applyMasterVolume();
fadeIn(titleMusic,options.masterVolume);

volumeSlider.addEventListener("input",()=>{
  options.masterVolume=Number(volumeSlider.value)/100;
  applyMasterVolume();
});
sensSlider.addEventListener("input",()=>{
  options.mouseSensitivity=Number(sensSlider.value)/1000;
});
flashToggle.addEventListener("change",()=>{
  options.flashlightEnabled=flashToggle.checked;
  if(window.gameFlashlight){
    gameFlashlight.visible=options.flashlightEnabled;
  }
});

settingsBtn.onclick=()=>{
  settingsPanel.style.display="block";
};
settingsClose.onclick=()=>{
  settingsPanel.style.display="none";
};
quitBtn.onclick=()=>{
  // For web, just hide title and stop audio
  titleScreen.style.display="none";
  fadeOut(titleMusic,800);
};

playBtn.onclick=()=>{
  titleScreen.style.display="none";
  settingsPanel.style.display="none";
  fadeOut(titleMusic,800);
  startGame();
};

// ===== THREE.JS GAME SCAFFOLD (NORMAL LIGHTING, ABANDONED VIBE) =====
let scene,camera,renderer,player,gameFlashlight;
let yaw=0,pitch=0;
const keys={};
const collisionBoxes=[];

function startGame(){
  const canvas=document.getElementById("gameCanvas");
  renderer=new THREE.WebGLRenderer({canvas,antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio||1);
  renderer.shadowMap.enabled=true;

  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x060814);
  // Slight bluish fog but not too strong
  scene.fog=new THREE.Fog(0x070a16,40,180); // normal-ish lighting [web:43][web:45]

  camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,2000);

  player=new THREE.Object3D();
  player.position.set(0,2,18);
  scene.add(player);
  player.add(camera);

  // Lighting: normal, factory ambient
  const ambient=new THREE.AmbientLight(0x8888aa,0.7);
  scene.add(ambient);

  const lobbyLight=new THREE.PointLight(0xffffff,1.3,50);
  lobbyLight.position.set(0,7,5);
  lobbyLight.castShadow=true;
  scene.add(lobbyLight);

  // Flashlight attached to camera
  gameFlashlight=new THREE.SpotLight(0xffffff,2.0,45,Math.PI/8,0.5);
  gameFlashlight.castShadow=true;
  camera.add(gameFlashlight);
  scene.add(camera);
  gameFlashlight.visible=options.flashlightEnabled;

  // Simple blockout of lobby: floor + walls + Huggy statue placeholder
  buildLobbyBlockout();

  // HUD on
  hud.style.display="block";
  info.style.display="block";
  crosshair.style.display="block";
  hud.textContent="LOBBY (BLOCKOUT)\nWalk around. This will evolve into full Chapter 1.";
  info.textContent="WASD – move | Mouse – look | SPACE – jump | F – flashlight";

  // Pointer lock + controls
  renderer.domElement.requestPointerLock=
    renderer.domElement.requestPointerLock||
    renderer.domElement.mozRequestPointerLock;
  renderer.domElement.addEventListener("click",()=>renderer.domElement.requestPointerLock());

  document.addEventListener("mousemove",(e)=>{
    if(document.pointerLockElement!==renderer.domElement)return;
    yaw-=e.movementX*options.mouseSensitivity;
    pitch-=e.movementY*options.mouseSensitivity;
    pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch));
    player.rotation.y=yaw;
    camera.rotation.x=pitch;
  });
  document.addEventListener("keydown",(e)=>{
    keys[e.code]=true;
    if(e.code==="KeyF"){
      options.flashlightEnabled=!options.flashlightEnabled;
      gameFlashlight.visible=options.flashlightEnabled;
      flashToggle.checked=options.flashlightEnabled;
    }
  });
  document.addEventListener("keyup",(e)=>{keys[e.code]=false;});

  window.addEventListener("resize",()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
  });

  // Start “normal” factory music
  stopAllMusic();
  applyMasterVolume();
  fadeIn(hallMusic,options.masterVolume);

  animate();
}

// Build a nicer lobby blockout for the title/game start
function addCollisionFrom(mesh){
  const box=new THREE.Box3().setFromObject(mesh);
  collisionBoxes.push(box);
}
function buildLobbyBlockout(){
  const floorMat=new THREE.MeshStandardMaterial({color:0x1b1f2d,roughness:0.8});
  const wallMat=new THREE.MeshStandardMaterial({color:0x262c3e,roughness:0.7});
  const trimMat=new THREE.MeshStandardMaterial({color:0x424a66,roughness:0.6});
  const huggyMat=new THREE.MeshStandardMaterial({color:0x004477});

  const lobby=new THREE.Group();

  // floor
  const floor=new THREE.Mesh(new THREE.BoxGeometry(30,0.3,30),floorMat);
  floor.position.set(0,0,0);
  floor.receiveShadow=true;
  lobby.add(floor);
  addCollisionFrom(floor);

  // walls
  const wallF=new THREE.Mesh(new THREE.BoxGeometry(30,8,0.4),wallMat);
  wallF.position.set(0,4,-15);
  lobby.add(wallF);
  addCollisionFrom(wallF);

  const wallB=wallF.clone();
  wallB.position.z=15;
  lobby.add(wallB);
  addCollisionFrom(wallB);

  const wallL=new THREE.Mesh(new THREE.BoxGeometry(0.4,8,30),wallMat);
  wallL.position.set(-15,4,0);
  lobby.add(wallL);
  addCollisionFrom(wallL);

  const wallR=wallL.clone();
  wallR.position.x=15;
  lobby.add(wallR);
  addCollisionFrom(wallR);

  // upper trim band
  const trim=new THREE.Mesh(new THREE.BoxGeometry(30.2,0.4,30.2),trimMat);
  trim.position.set(0,8,0);
  lobby.add(trim);

  // center Huggy statue placeholder
  const huggyBody=new THREE.Mesh(new THREE.CylinderGeometry(1.2,1.2,5,8),huggyMat);
  huggyBody.position.set(0,2.8,-4);
  huggyBody.castShadow=true;
  lobby.add(huggyBody);
  const huggyHead=new THREE.Mesh(new THREE.SphereGeometry(1.4,16,16),huggyMat);
  huggyHead.position.set(0,5.6,-4);
  huggyBody.add(huggyHead);

  // front reception desk
  const desk=new THREE.Mesh(new THREE.BoxGeometry(8,1.5,2),trimMat);
  desk.position.set(0,1,6);
  desk.castShadow=true;
  lobby.add(desk);
  addCollisionFrom(desk);

  // side door placeholder (to power room etc.)
  const leftDoor=new THREE.Mesh(new THREE.BoxGeometry(3,6,0.4),trimMat);
  leftDoor.position.set(-10,3,-15);
  lobby.add(leftDoor);
  addCollisionFrom(leftDoor);

  scene.add(lobby);
}

// Collision resolution vs walls (simple point-with-radius vs Box3)
function canMoveTo(nextPos,radius=0.7){
  for(const box of collisionBoxes){
    const expanded=box.clone();
    expanded.min.x-=radius;
    expanded.max.x+=radius;
    expanded.min.z-=radius;
    expanded.max.z+=radius;
    expanded.min.y=-Infinity;
    expanded.max.y=Infinity;
    if(expanded.containsPoint(nextPos)){
      return false;
    }
  }
  return true;
}

function animate(){
  requestAnimationFrame(animate);
  if(!renderer || !scene)return;
  const dt=0.016;

  if(player){
    const forward=new THREE.Vector3();
    camera.getWorldDirection(forward);
    forward.y=0;forward.normalize();
    const right=new THREE.Vector3();
    right.crossVectors(forward,new THREE.Vector3(0,1,0)).normalize();

    let move=new THREE.Vector3();
    if(keys["KeyW"])move.add(forward);
    if(keys["KeyS"])move.sub(forward);
    if(keys["KeyA"])move.sub(right);
    if(keys["KeyD"])move.add(right);
    if(move.lengthSq()>0)move.normalize();

    const speed=6;
    const step=move.clone().multiplyScalar(speed*dt);
    const nextPos=player.position.clone().add(step);
    if(canMoveTo(nextPos,0.7)){
      player.position.copy(nextPos);
    }

    // gravity stub
    // (for now just lock to y=2 so it feels normal height)
    player.position.y=2;
  }

  renderer.render(scene,camera);
}
</script>
</body>
</html>
