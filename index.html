<!DOCTYPE html>
<html>
<head>
<title>Project Playcare</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }
#ui{
position:absolute;
top:10px;
left:10px;
color:white;
font-size:14px;
display:none;
}
#titleScreen{
position:absolute;
width:100%;
height:100%;
background:black;
color:white;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
font-size:50px;
text-align:center;
}
#subtitle{
font-size:20px;
margin-top:20px;
opacity:0.7;
}
#centerMsg{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
color:white;
font-size:40px;
display:none;
text-align:center;
}
#credits{
position:absolute;
bottom:-100%;
width:100%;
text-align:center;
color:white;
font-size:22px;
display:none;
}
</style>
</head>
<body>

<div id="titleScreen">
PROJECT PLAYCARE
<div id="subtitle">Click To Start</div>
</div>

<div id="ui">
WASD Move | Shift Sprint | Space Jump | F Flashlight | E Interact
</div>

<div id="centerMsg"></div>
<div id="credits"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/js/controls/PointerLockControls.js"></script>

<script>

/* ================= AUDIO ================= */

const audio = {
title: new Audio("Title music.mp3"),
explore: new Audio("Bgm-1.mp3"),
boss: new Audio("chase music.mp3"),
watcher: new Audio("Prototype encounter music.mp3")
};

for(let k in audio){
audio[k].loop = true;
audio[k].volume = 0.5;
}

function stopAll(){
for(let k in audio){
audio[k].pause();
audio[k].currentTime = 0;
}
}

function fadeIn(track){
track.volume = 0;
track.play();
let v = 0;
let f = setInterval(()=>{
v += 0.02;
track.volume = v;
if(v >= 0.5) clearInterval(f);
},100);
}

function fadeOut(track){
let f = setInterval(()=>{
track.volume -= 0.02;
if(track.volume <= 0){
track.pause();
clearInterval(f);
}
},100);
}

/* ================= TITLE ================= */

audio.title.play();

document.getElementById("titleScreen").addEventListener("click",()=>{
document.getElementById("titleScreen").style.display="none";
document.getElementById("ui").style.display="block";
fadeOut(audio.title);
startGame();
});

/* ================= THREE ================= */

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x000000);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

let controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener("click", ()=>controls.lock());
scene.add(controls.getObject());

/* Lighting FIXED */

let ambient = new THREE.AmbientLight(0x555555);
scene.add(ambient);

let light = new THREE.PointLight(0xffffff, 1, 200);
light.position.set(0,20,0);
scene.add(light);

/* ================= ROOM ================= */

function createWall(x,y,z,w,h,d){
let wall = new THREE.Mesh(
new THREE.BoxGeometry(w,h,d),
new THREE.MeshStandardMaterial({color:0x222222})
);
wall.position.set(x,y,z);
scene.add(wall);
}

let roomSize = 100;

/* Floor */
let floor = new THREE.Mesh(
new THREE.BoxGeometry(roomSize,2,roomSize),
new THREE.MeshStandardMaterial({color:0x111111})
);
floor.position.y = -1;
scene.add(floor);

/* Walls */
createWall(0,25,-roomSize/2,roomSize,50,2);
createWall(0,25,roomSize/2,roomSize,50,2);
createWall(-roomSize/2,25,0,2,50,roomSize);
createWall(roomSize/2,25,0,2,50,roomSize);

/* ================= PLAYER ================= */

camera.position.set(0,5,20);

/* ================= GAME FLOW ================= */

let door = new THREE.Mesh(
new THREE.BoxGeometry(10,20,2),
new THREE.MeshStandardMaterial({color:0x550000})
);
door.position.set(0,10,-40);
scene.add(door);

let doorOpened = false;
let boss;
let bossActive = false;
let bossHealth = 5;
let watcher;

function startGame(){
fadeIn(audio.explore);
}

function interact(){
if(!doorOpened && camera.position.distanceTo(door.position)<15){
openDoor();
}

if(bossActive && camera.position.distanceTo(boss.position)<20){
bossHealth--;
boss.material.color.set(0xff0000);
setTimeout(()=>boss.material.color.set(0x111111),200);
if(bossHealth<=0) defeatBoss();
}
}

document.addEventListener("keydown",e=>{
if(e.code==="KeyE") interact();
});

function openDoor(){
doorOpened=true;
fadeOut(audio.explore);

let open=setInterval(()=>{
door.position.y+=0.5;
if(door.position.y>40){
clearInterval(open);
startBoss();
}
},16);
}

function startBoss(){
boss = new THREE.Mesh(
new THREE.BoxGeometry(15,25,15),
new THREE.MeshStandardMaterial({color:0x111111})
);
boss.position.set(0,12,-70);
scene.add(boss);
bossActive=true;
fadeIn(audio.boss);
}

function updateBoss(){
if(!bossActive) return;

let dir = new THREE.Vector3().subVectors(camera.position,boss.position).normalize();
boss.position.add(dir.multiplyScalar(0.2));

if(boss.position.distanceTo(camera.position)<10){
gameOver("CRUSHED");
}
}

function defeatBoss(){
bossActive=false;
scene.remove(boss);
fadeOut(audio.boss);
startWatcher();
}

function startWatcher(){
fadeIn(audio.watcher);

ambient.intensity = 0.1;

watcher = new THREE.Mesh(
new THREE.BoxGeometry(60,100,20),
new THREE.MeshStandardMaterial({color:0x000000})
);
watcher.position.set(0,50,-150);
scene.add(watcher);

document.getElementById("centerMsg").style.display="block";
document.getElementById("centerMsg").innerText="IT WAS NEVER ALONE...";

setTimeout(()=>fadeToBlack(),5000);
}

function fadeToBlack(){
let fade = 0;
let overlay = document.createElement("div");
overlay.style.position="absolute";
overlay.style.width="100%";
overlay.style.height="100%";
overlay.style.background="black";
overlay.style.opacity=0;
overlay.style.top=0;
document.body.appendChild(overlay);

let f=setInterval(()=>{
fade+=0.02;
overlay.style.opacity=fade;
if(fade>=1){
clearInterval(f);
startCredits();
}
},50);
}

function startCredits(){
document.getElementById("centerMsg").style.display="none";
stopAll();

let credits=document.getElementById("credits");
credits.style.display="block";
credits.innerHTML=`
<br><br>
PROJECT PLAYCARE<br><br>
Created By: Weskc0<br><br>
Programming & Design<br>
Audio Integration<br><br>
Powered by Three.js<br><br>
Thank You For Playing<br><br>
(Refresh Page To Restart)
`;

let pos=-100;
let scroll=setInterval(()=>{
pos+=0.3;
credits.style.bottom=pos+"%";
if(pos>=100){
clearInterval(scroll);
}
},30);
}

function gameOver(text){
stopAll();
document.getElementById("centerMsg").style.display="block";
document.getElementById("centerMsg").innerText=text;
controls.unlock();
}

/* ================= LOOP ================= */

function animate(){
requestAnimationFrame(animate);
updateBoss();
renderer.render(scene,camera);
}
animate();

</script>
</body>
</html>
