<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Playcare</title>

<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }

#titleScreen {
position:absolute;
width:100%;
height:100%;
background:radial-gradient(circle at center, #111 0%, #000 100%);
color:white;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:300;
text-align:center;
}

#titleScreen h1 {
font-size:70px;
letter-spacing:6px;
margin:0;
}

#startBtn {
margin-top:40px;
padding:15px 50px;
font-size:20px;
cursor:pointer;
background:white;
border:none;
}

#loadingScreen {
position:absolute;
width:100%;
height:100%;
background:black;
color:white;
display:none;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:250;
}

#loadingBarContainer {
width:400px;
height:20px;
background:#222;
margin-top:20px;
}

#loadingBar {
width:0%;
height:100%;
background:white;
}

#ui {
position:absolute;
bottom:20px;
left:20px;
color:white;
font-size:14px;
opacity:0.8;
display:none;
}
</style>
</head>
<body>

<div id="titleScreen">
<h1>PROJECT PLAYCARE</h1>
<button id="startBtn">Enter Playcare</button>
</div>

<div id="loadingScreen">
<h2>Loading...</h2>
<div id="loadingBarContainer">
<div id="loadingBar"></div>
</div>
</div>

<div id="ui">
WASD Move | Shift Sprint | Space Jump | E Interact
</div>

<audio id="titleMusic" src="Title music.mp3" loop></audio>
<audio id="bgm1" src="Bgm-1.mp3" loop></audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>

/* ================= AUDIO ================= */

const titleMusic = document.getElementById("titleMusic");
const bgm1 = document.getElementById("bgm1");

titleMusic.volume = 0.6;
bgm1.volume = 0.5;

window.addEventListener("load",()=>{
titleMusic.play().catch(()=>{});
});

/* ================= TITLE FLOW ================= */

const titleScreen = document.getElementById("titleScreen");
const loadingScreen = document.getElementById("loadingScreen");
const startBtn = document.getElementById("startBtn");
const loadingBar = document.getElementById("loadingBar");
const ui = document.getElementById("ui");

startBtn.addEventListener("click",()=>{
titleMusic.pause();
titleMusic.currentTime=0;

titleScreen.style.display="none";
loadingScreen.style.display="flex";

let progress=0;
let loader=setInterval(()=>{
progress+=10;
loadingBar.style.width=progress+"%";
if(progress>=100){
clearInterval(loader);
loadingScreen.style.display="none";
initGame();
}
},150);
});

/* ================= GAME ================= */

let scene, camera, renderer;
let player;
let colliders=[];
let door;
let doorOpen=false;

function initGame(){

bgm1.play();
ui.style.display="block";

scene=new THREE.Scene();
scene.background=new THREE.Color(0x2c2f36);

camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,2000);

renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.6));

const light=new THREE.PointLight(0xffffff,1,100);
light.position.set(0,8,-10);
scene.add(light);

/* FLOOR */
const floor=new THREE.Mesh(
new THREE.PlaneGeometry(300,300),
new THREE.MeshStandardMaterial({color:0x555555})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

/* COLLISION */
function addCollider(mesh){
mesh.userData.box=new THREE.Box3().setFromObject(mesh);
colliders.push(mesh);
}

function checkCollision(position){
const playerBox=new THREE.Box3().setFromCenterAndSize(
position,
new THREE.Vector3(1,3,1)
);
for(let obj of colliders){
obj.userData.box.setFromObject(obj);
if(playerBox.intersectsBox(obj.userData.box)){
return true;
}
}
return false;
}

function wall(x,y,z,w,h,d,color=0x999999){
const mesh=new THREE.Mesh(
new THREE.BoxGeometry(w,h,d),
new THREE.MeshStandardMaterial({color})
);
mesh.position.set(x,y,z);
scene.add(mesh);
addCollider(mesh);
return mesh;
}

/* SPAWN */
wall(0,5,5,20,10,1);
wall(-10,5,-5,1,10,20);
wall(10,5,-5,1,10,20);
wall(-6,5,-15,8,10,1);
wall(6,5,-15,8,10,1);
wall(0,9,-15,4,2,1);

/* DOOR */
door=new THREE.Mesh(
new THREE.BoxGeometry(4,8,0.8),
new THREE.MeshStandardMaterial({color:0x3333aa})
);
door.position.set(0,4,-15);
scene.add(door);
addCollider(door);

/* PLAYER */
player=new THREE.Object3D();
player.position.set(0,2,0);
scene.add(player);
player.add(camera);

/* POINTER LOCK */
renderer.domElement.addEventListener("click",()=>{
renderer.domElement.requestPointerLock();
});

let yaw=0;
let pitch=0;

document.addEventListener("mousemove",(e)=>{
if(document.pointerLockElement===renderer.domElement){
yaw-=e.movementX*0.002;
pitch-=e.movementY*0.002;
pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch));
player.rotation.y=yaw;
camera.rotation.x=pitch;
}
});

/* MOVEMENT FIXED */

let keys={};
let velocityY=0;
let canJump=false;
let gravity=30;
let moveSpeed=6;
let sprintSpeed=10;
let prevTime=performance.now();

document.addEventListener("keydown",e=>{
keys[e.code]=true;
if(e.code==="KeyE") interact();
});
document.addEventListener("keyup",e=>keys[e.code]=false);

function interact(){
if(!doorOpen && player.position.distanceTo(door.position)<4){
doorOpen=true;
scene.remove(door);
colliders.splice(colliders.indexOf(door),1);
}
}

function animate(){
requestAnimationFrame(animate);

let time=performance.now();
let delta=(time-prevTime)/1000;
prevTime=time;

/* Movement relative to camera direction */
let forward=new THREE.Vector3();
camera.getWorldDirection(forward);
forward.y=0;
forward.normalize();

let right=new THREE.Vector3();
right.crossVectors(forward,new THREE.Vector3(0,1,0)).normalize();

let moveDir=new THREE.Vector3();

if(keys["KeyW"]) moveDir.add(forward);
if(keys["KeyS"]) moveDir.sub(forward);
if(keys["KeyA"]) moveDir.sub(right);
if(keys["KeyD"]) moveDir.add(right);

moveDir.normalize();

let speed=(keys["ShiftLeft"]||keys["ShiftRight"])?sprintSpeed:moveSpeed;

let newPos=player.position.clone();
newPos.addScaledVector(moveDir,speed*delta);

if(!checkCollision(newPos)){
player.position.x=newPos.x;
player.position.z=newPos.z;
}

/* Gravity */
velocityY-=gravity*delta;

if(keys["Space"] && canJump){
velocityY=12;
canJump=false;
}

player.position.y+=velocityY*delta;

if(player.position.y<=2){
player.position.y=2;
velocityY=0;
canJump=true;
}

renderer.render(scene,camera);
}
animate();

}

</script>
</body>
</html>
