<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Playcare - Tutorial V2</title>

<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }

#overlay {
position:absolute;
top:0; left:0;
width:100%; height:100%;
background:black;
color:white;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
font-size:32px;
cursor:pointer;
z-index:100;
text-align:center;
}

#ui {
position:absolute;
bottom:20px;
left:20px;
color:white;
font-size:18px;
z-index:50;
}

#prompt {
position:absolute;
top:20px;
left:50%;
transform:translateX(-50%);
color:white;
font-size:20px;
z-index:50;
}
</style>
</head>
<body>

<div id="overlay">
PROJECT PLAYCARE<br>
<div style="font-size:18px; opacity:0.7; margin-top:15px;">
Click To Wake Up
</div>
</div>

<div id="ui">
WASD Move | Shift Sprint | Space Jump | F Flashlight | E Interact
</div>

<div id="prompt"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>

/* ================= SCENE ================= */

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x303040);

const camera = new THREE.PerspectiveCamera(
75,
window.innerWidth/window.innerHeight,
0.1,
2000
);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ================= LIGHTING ================= */

const ambient = new THREE.AmbientLight(0xffffff,0.7);
scene.add(ambient);

function ceilingLight(x,z){
const light = new THREE.PointLight(0xffffff,0.8,50);
light.position.set(x,8,z);
scene.add(light);

const bulb = new THREE.Mesh(
new THREE.SphereGeometry(0.3),
new THREE.MeshStandardMaterial({color:0xffffcc})
);
bulb.position.copy(light.position);
scene.add(bulb);
}

ceilingLight(0,-10);
ceilingLight(0,-40);

/* ================= FLOOR ================= */

const floor = new THREE.Mesh(
new THREE.PlaneGeometry(400,400),
new THREE.MeshStandardMaterial({color:0x666666})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

/* ================= BUILDING HELPERS ================= */

function wall(x,y,z,w,h,d,color=0x999999){
const mesh = new THREE.Mesh(
new THREE.BoxGeometry(w,h,d),
new THREE.MeshStandardMaterial({color})
);
mesh.position.set(x,y,z);
scene.add(mesh);
return mesh;
}

/* ================= SPAWN ROOM ================= */

wall(0,5,-20,30,10,1);
wall(-15,5,-5,1,10,30);
wall(15,5,-5,1,10,30);
wall(0,10,-5,30,1,30);
wall(0,0,-5,30,1,30);

/* Close Back */
wall(0,5,10,30,10,1);

/* EXIT SIGN */
const exitSign = new THREE.Mesh(
new THREE.BoxGeometry(4,1,0.2),
new THREE.MeshStandardMaterial({color:0x00ff00})
);
exitSign.position.set(0,8,-20.6);
scene.add(exitSign);

/* ================= CORRIDOR ================= */

wall(-8,5,-40,1,10,40);
wall(8,5,-40,1,10,40);
wall(0,10,-40,16,1,40);

/* ================= DOOR FRAME ================= */

wall(-4,4,-60,1,8,1);
wall(4,4,-60,1,8,1);
wall(0,8,-60,8,1,1);

/* Sliding Door */
let door = wall(0,4,-60,6,8,0.5,0x3333aa);
let doorOpen = false;

/* ================= BATTERY ================= */

let battery = new THREE.Mesh(
new THREE.BoxGeometry(1,1,1),
new THREE.MeshStandardMaterial({color:0xffff00})
);
battery.position.set(5,1,-30);
scene.add(battery);
let batteryCollected=false;

/* ================= PLAYER ================= */

const player = new THREE.Object3D();
player.position.set(0,2,0);
scene.add(player);
player.add(camera);

let velocity=new THREE.Vector3();
let direction=new THREE.Vector3();

let moveSpeed=4;
let sprintSpeed=7;
let gravity=20;
let jumpForce=8;

let canJump=false;
let keys={};

/* ================= INPUT ================= */

document.addEventListener("keydown",e=>{
keys[e.code]=true;

if(e.code==="KeyF"){
flashlightOn=!flashlightOn;
flashlight.intensity=flashlightOn?2:0;
}

if(e.code==="KeyE"){
interact();
}
});

document.addEventListener("keyup",e=>keys[e.code]=false);

/* ================= FLASHLIGHT ================= */

const flashlight=new THREE.SpotLight(0xffffff,0);
flashlight.angle=Math.PI/7;
flashlight.distance=200;

camera.add(flashlight);
camera.add(flashlight.target);
flashlight.position.set(0,0.5,-0.5);
flashlight.target.position.set(0,0,-5);

let flashlightOn=false;

/* ================= INTERACTION ================= */

function interact(){

if(!batteryCollected &&
player.position.distanceTo(battery.position)<3){
batteryCollected=true;
scene.remove(battery);
showPrompt("Battery Collected");
}

if(!doorOpen &&
player.position.distanceTo(door.position)<4){

if(batteryCollected){
doorOpen=true;
showPrompt("Door Powered");
}else{
showPrompt("Door Needs Power");
}
}
}

function showPrompt(text){
const p=document.getElementById("prompt");
p.innerText=text;
setTimeout(()=>p.innerText="",2000);
}

/* ================= POINTER LOCK ================= */

const overlay=document.getElementById("overlay");
overlay.addEventListener("click",()=>{
renderer.domElement.requestPointerLock();
});

document.addEventListener("pointerlockchange",()=>{
if(document.pointerLockElement===renderer.domElement){
overlay.style.display="none";
}
});

/* ================= MOUSE LOOK ================= */

let yaw=0;
let pitch=0;

document.addEventListener("mousemove",(event)=>{
if(document.pointerLockElement===renderer.domElement){
yaw-=event.movementX*0.002;
pitch-=event.movementY*0.002;
pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch));
player.rotation.y=yaw;
camera.rotation.x=pitch;
}
});

/* ================= MOVEMENT ================= */

let prevTime=performance.now();

function animate(){
requestAnimationFrame(animate);

let time=performance.now();
let delta=(time-prevTime)/1000;
prevTime=time;

direction.set(0,0,0);
if(keys["KeyW"]) direction.z-=1;
if(keys["KeyS"]) direction.z+=1;
if(keys["KeyA"]) direction.x-=1;
if(keys["KeyD"]) direction.x+=1;
direction.normalize();

let speed=(keys["ShiftLeft"]||keys["ShiftRight"])?sprintSpeed:moveSpeed;

velocity.x=direction.x*speed;
velocity.z=direction.z*speed;
velocity.y-=gravity*delta;

if(keys["Space"]&&canJump){
velocity.y=jumpForce;
canJump=false;
}

player.translateX(velocity.x*delta);
player.translateZ(velocity.z*delta);
player.position.y+=velocity.y*delta;

if(player.position.y<2){
velocity.y=0;
player.position.y=2;
canJump=true;
}

/* Smooth sliding door */
if(doorOpen && door.position.x<10){
door.position.x+=10*delta;
}

/* Battery Spin */
if(!batteryCollected){
battery.rotation.y+=2*delta;
}

renderer.render(scene,camera);
}

animate();

/* ================= RESIZE ================= */

window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>
