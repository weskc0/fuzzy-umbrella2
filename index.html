<!DOCTYPE html>
<html>
<head>
<title>Project Playcare</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }
#ui{
position:absolute;
top:10px;
left:10px;
color:white;
font-size:14px;
display:none;
}
#titleScreen{
position:absolute;
width:100%;
height:100%;
background:black;
color:white;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
font-size:50px;
text-align:center;
}
#subtitle{
font-size:20px;
margin-top:20px;
opacity:0.7;
}
#centerMsg{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
color:white;
font-size:40px;
display:none;
text-align:center;
}
#credits{
position:absolute;
bottom:-100%;
width:100%;
text-align:center;
color:white;
font-size:22px;
display:none;
}
</style>
</head>
<body>

<div id="titleScreen">
PROJECT PLAYCARE
<div id="subtitle">Click To Start</div>
</div>

<div id="ui">
WASD Move | Shift Sprint | Space Jump | F Flashlight | E Interact
</div>

<div id="centerMsg"></div>
<div id="credits"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152/examples/js/controls/PointerLockControls.js"></script>

<script>

/* ================= AUDIO SYSTEM ================= */

const audio = {
title: new Audio("Title music.mp3"),
explore: new Audio("Bgm-1.mp3"),
boss: new Audio("chase music.mp3"),
watcher: new Audio("Prototype encounter music.mp3")
};

for(let key in audio){
audio[key].loop = true;
audio[key].volume = 0.5;
}

function stopAllAudio(){
for(let key in audio){
audio[key].pause();
audio[key].currentTime = 0;
}
}

function fadeIn(track){
track.volume = 0;
track.play();
let v = 0;
let f = setInterval(()=>{
v += 0.02;
track.volume = v;
if(v >= 0.5) clearInterval(f);
},100);
}

function fadeOut(track){
let f = setInterval(()=>{
track.volume -= 0.02;
if(track.volume <= 0){
track.pause();
clearInterval(f);
}
},100);
}

/* ================= TITLE SCREEN ================= */

document.getElementById("titleScreen").addEventListener("click",()=>{
document.getElementById("titleScreen").style.display="none";
document.getElementById("ui").style.display="block";
fadeOut(audio.title);
startGame();
});

audio.title.play();

/* ================= THREE SETUP ================= */

let scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x000000,20,200);

let camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,2000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

let controls = new THREE.PointerLockControls(camera,document.body);
document.body.addEventListener("click",()=>controls.lock());
scene.add(controls.getObject());

let ambient = new THREE.AmbientLight(0x303030);
scene.add(ambient);

let flashlight = new THREE.SpotLight(0xffffff,4,120,Math.PI/10);
camera.add(flashlight);
camera.add(flashlight.target);
scene.add(camera);

/* ================= WORLD ================= */

let floor = new THREE.Mesh(
new THREE.PlaneGeometry(1000,1000),
new THREE.MeshStandardMaterial({color:0x111111})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

/* ================= MOVEMENT ================= */

let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();
let move = {forward:false,back:false,left:false,right:false,sprint:false};
let canJump = true;

document.addEventListener("keydown",e=>{
if(e.code==="KeyW") move.forward=true;
if(e.code==="KeyS") move.back=true;
if(e.code==="KeyA") move.left=true;
if(e.code==="KeyD") move.right=true;
if(e.code==="ShiftLeft") move.sprint=true;
if(e.code==="Space" && canJump){ velocity.y+=8; canJump=false; }
if(e.code==="KeyF") flashlight.visible=!flashlight.visible;
if(e.code==="KeyE") interact();
});

document.addEventListener("keyup",e=>{
if(e.code==="KeyW") move.forward=false;
if(e.code==="KeyS") move.back=false;
if(e.code==="KeyA") move.left=false;
if(e.code==="KeyD") move.right=false;
if(e.code==="ShiftLeft") move.sprint=false;
});

/* ================= DOOR ================= */

let door = new THREE.Mesh(
new THREE.BoxGeometry(6,6,1),
new THREE.MeshStandardMaterial({color:0x550000})
);
door.position.set(0,3,-50);
scene.add(door);

let doorOpened=false;

/* ================= BOSS ================= */

let boss;
let bossHealth=5;
let bossActive=false;

/* ================= WATCHER ================= */

let watcher;

/* ================= GAME FLOW ================= */

function startGame(){
fadeIn(audio.explore);
}

function interact(){
if(!doorOpened && camera.position.distanceTo(door.position)<10){
openDoor();
}

if(bossActive && camera.position.distanceTo(boss.position)<12){
bossHealth--;
boss.material.color.set(0xff0000);
setTimeout(()=>boss.material.color.set(0x111111),200);
if(bossHealth<=0) defeatBoss();
}
}

function openDoor(){
doorOpened=true;
fadeOut(audio.explore);

let open=setInterval(()=>{
door.position.y+=0.2;
if(door.position.y>10){
clearInterval(open);
startBoss();
}
},16);
}

function startBoss(){
boss = new THREE.Mesh(
new THREE.BoxGeometry(10,12,10),
new THREE.MeshStandardMaterial({color:0x111111})
);
boss.position.set(0,6,-120);
scene.add(boss);
bossActive=true;
fadeIn(audio.boss);
}

function updateBoss(){
if(!bossActive) return;

let dir = new THREE.Vector3().subVectors(camera.position,boss.position).normalize();
boss.position.add(dir.multiplyScalar(0.1));

if(boss.position.distanceTo(camera.position)<6){
gameOver("CRUSHED");
}
}

function defeatBoss(){
bossActive=false;
scene.remove(boss);
fadeOut(audio.boss);
startWatcher();
}

function startWatcher(){
fadeIn(audio.watcher);

ambient.intensity=0.05;

watcher = new THREE.Mesh(
new THREE.BoxGeometry(80,120,30),
new THREE.MeshStandardMaterial({color:0x000000})
);
watcher.position.set(0,60,-250);
scene.add(watcher);

document.getElementById("centerMsg").style.display="block";
document.getElementById("centerMsg").innerText="IT WAS NEVER ALONE...";

setTimeout(()=>{
fadeToBlack();
},5000);
}

function fadeToBlack(){
let fade=0;
let overlay=new THREE.Mesh(
new THREE.PlaneGeometry(5000,5000),
new THREE.MeshBasicMaterial({color:0x000000,transparent:true,opacity:0})
);
overlay.position.z=-5;
camera.add(overlay);

let f=setInterval(()=>{
fade+=0.02;
overlay.material.opacity=fade;
if(fade>=1){
clearInterval(f);
startCredits();
}
},50);
}

function startCredits(){
document.getElementById("centerMsg").style.display="none";

let credits=document.getElementById("credits");
credits.style.display="block";
credits.innerHTML=`
<br><br>
PROJECT PLAYCARE<br><br>
Created By: Your Name<br><br>
Programming & Design<br>
Audio Integration<br>
Game Systems<br><br>
Powered by Three.js<br><br>
Thank You For Playing<br><br>
(Click To Restart)
`;

let pos=-100;
let scroll=setInterval(()=>{
pos+=0.3;
credits.style.bottom=pos+"%";
if(pos>=100){
clearInterval(scroll);
}
},30);

document.addEventListener("click",()=>location.reload());
}

function gameOver(text){
stopAllAudio();
document.getElementById("centerMsg").style.display="block";
document.getElementById("centerMsg").innerText=text;
controls.unlock();
}

/* ================= LOOP ================= */

camera.position.y=2;

function animate(){
requestAnimationFrame(animate);

velocity.y-=0.4;
direction.z=Number(move.forward)-Number(move.back);
direction.x=Number(move.right)-Number(move.left);
direction.normalize();

let speed=move.sprint?0.4:0.2;

if(move.forward||move.back) controls.moveForward(direction.z*speed);
if(move.left||move.right) controls.moveRight(direction.x*speed);

camera.position.y+=velocity.y*0.1;
if(camera.position.y<2){velocity.y=0;camera.position.y=2;canJump=true;}

updateBoss();

renderer.render(scene,camera);
}
animate();

</script>
</body>
</html>
