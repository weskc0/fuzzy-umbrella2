<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Playcare - Movement Working</title>
<style>
body { margin:0; overflow:hidden; background:black; }
#overlay {
position:absolute;
width:100%;
height:100%;
background:black;
color:white;
display:flex;
align-items:center;
justify-content:center;
font-size:40px;
cursor:pointer;
z-index:10;
}
#ui {
position:absolute;
top:10px;
left:10px;
color:white;
font-family:monospace;
font-size:14px;
display:none;
}
</style>
</head>
<body>

<div id="overlay">Click To Enter</div>
<div id="ui">WASD Move | Mouse Look</div>

<script type="module">

import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js';
import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/controls/PointerLockControls.js';

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x111111);

let camera = new THREE.PerspectiveCamera(
75,
window.innerWidth/window.innerHeight,
0.1,
1000
);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ================= CONTROLS ================= */

let controls = new PointerLockControls(camera, document.body);
scene.add(controls.getObject());

const overlay = document.getElementById("overlay");

overlay.addEventListener("click", () => {
controls.lock();
});

controls.addEventListener("lock", () => {
overlay.style.display = "none";
document.getElementById("ui").style.display = "block";
});

controls.addEventListener("unlock", () => {
overlay.style.display = "flex";
document.getElementById("ui").style.display = "none";
});

/* ================= LIGHTING ================= */

let ambient = new THREE.AmbientLight(0xffffff, 0.4);
scene.add(ambient);

let light = new THREE.DirectionalLight(0xffffff, 0.8);
light.position.set(10,20,10);
scene.add(light);

/* ================= ROOM ================= */

function wall(x,y,z,w,h,d,color=0x333333){
let mesh = new THREE.Mesh(
new THREE.BoxGeometry(w,h,d),
new THREE.MeshStandardMaterial({color})
);
mesh.position.set(x,y,z);
scene.add(mesh);
}

let size = 100;

// floor
wall(0,-1,0,size,2,size,0x222222);

// walls
wall(0,25,-size/2,size,50,2);
wall(0,25,size/2,size,50,2);
wall(-size/2,25,0,2,50,size);
wall(size/2,25,0,2,50,size);

// door
let door = new THREE.Mesh(
new THREE.BoxGeometry(10,20,2),
new THREE.MeshStandardMaterial({color:0x550000})
);
door.position.set(0,10,-40);
scene.add(door);

/* ================= MOVEMENT ================= */

let move = {forward:false, back:false, left:false, right:false};
let direction = new THREE.Vector3();

document.addEventListener("keydown", e=>{
if(e.code==="KeyW") move.forward=true;
if(e.code==="KeyS") move.back=true;
if(e.code==="KeyA") move.left=true;
if(e.code==="KeyD") move.right=true;
});

document.addEventListener("keyup", e=>{
if(e.code==="KeyW") move.forward=false;
if(e.code==="KeyS") move.back=false;
if(e.code==="KeyA") move.left=false;
if(e.code==="KeyD") move.right=false;
});

camera.position.set(0,5,20);

function animate(){
requestAnimationFrame(animate);

direction.z = Number(move.forward) - Number(move.back);
direction.x = Number(move.right) - Number(move.left);
direction.normalize();

if(move.forward || move.back)
controls.moveForward(direction.z * 0.3);

if(move.left || move.right)
controls.moveRight(direction.x * 0.3);

renderer.render(scene, camera);
}

animate();

</script>

</body>
</html>
