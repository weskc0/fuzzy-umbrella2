<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Playcare</title>
<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }

#titleScreen, #loadingScreen {
position:absolute;
width:100%;
height:100%;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
background:black;
color:white;
z-index:20;
}

#titleScreen h1{
font-size:48px;
margin:0;
}

#titleScreen button{
margin-top:20px;
padding:10px 20px;
font-size:18px;
cursor:pointer;
}

#crosshair{
position:absolute;
top:50%;
left:50%;
width:6px;
height:6px;
background:white;
transform:translate(-50%,-50%);
display:none;
z-index:10;
}

</style>
</head>
<body>

<div id="titleScreen">
<h1>PROJECT PLAYCARE</h1>
<button id="startBtn">Start Game</button>
</div>

<div id="loadingScreen" style="display:none;">
<h2>Loading...</h2>
</div>

<div id="crosshair"></div>

<audio id="titleMusic" src="Title music.mp3" loop></audio>
<audio id="bgm" src="Bgm-1.mp3" loop></audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>

/* ================= GAME STATE ================= */

let gameState="title";

const titleScreen=document.getElementById("titleScreen");
const loadingScreen=document.getElementById("loadingScreen");
const startBtn=document.getElementById("startBtn");
const crosshair=document.getElementById("crosshair");

const titleMusic=document.getElementById("titleMusic");
const bgm=document.getElementById("bgm");

titleMusic.volume=0;
bgm.volume=0;

function fadeIn(audio,target=1,duration=2000){
audio.play();
let step=target/(duration/50);
let interval=setInterval(()=>{
audio.volume=Math.min(target,audio.volume+step);
if(audio.volume>=target) clearInterval(interval);
},50);
}

function fadeOut(audio,duration=2000){
let step=audio.volume/(duration/50);
let interval=setInterval(()=>{
audio.volume=Math.max(0,audio.volume-step);
if(audio.volume<=0){
audio.pause();
clearInterval(interval);
}
},50);
}

/* ================= START FLOW ================= */

fadeIn(titleMusic,1,2000);

startBtn.onclick=()=>{
fadeOut(titleMusic,1500);
titleScreen.style.display="none";
loadingScreen.style.display="flex";
gameState="loading";

setTimeout(()=>{
loadingScreen.style.display="none";
initGame();
gameState="game";
fadeIn(bgm,0.7,2000);
},1500);
};

/* ================= THREE CORE ================= */

let scene,camera,renderer,player;
let colliders=[];
let yaw=0,pitch=0;
let keys={};
let velocityY=0;
let canJump=false;
let prevTime=performance.now();

function addCollider(mesh){
mesh.userData.box=new THREE.Box3().setFromObject(mesh);
colliders.push(mesh);
}

function checkCollision(pos){
const box=new THREE.Box3().setFromCenterAndSize(
pos,new THREE.Vector3(1.2,3,1.2)
);
for(let obj of colliders){
obj.userData.box.setFromObject(obj);
if(box.intersectsBox(obj.userData.box)) return true;
}
return false;
}

function wall(x,y,z,w,h,d,mat){
const mesh=new THREE.Mesh(
new THREE.BoxGeometry(w,h,d),mat
);
mesh.position.set(x,y,z);
scene.add(mesh);
addCollider(mesh);
}

/* ================= INIT GAME ================= */

function initGame(){

scene=new THREE.Scene();
scene.background=new THREE.Color(0xcfefff);
scene.fog=new THREE.Fog(0xcfefff,80,300);

camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,2000);

renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

renderer.domElement.addEventListener("click",()=>{
renderer.domElement.requestPointerLock();
});

scene.add(new THREE.AmbientLight(0xffffff,0.8));
const sun=new THREE.DirectionalLight(0xffffff,0.6);
sun.position.set(100,200,100);
scene.add(sun);

/* Materials */
const matBlue=new THREE.MeshStandardMaterial({color:0x4aa8ff});
const matYellow=new THREE.MeshStandardMaterial({color:0xffe066});
const matWhite=new THREE.MeshStandardMaterial({color:0xffffff});
const matGray=new THREE.MeshStandardMaterial({color:0xcccccc});
const matDark=new THREE.MeshStandardMaterial({color:0x333333});

/* Floor */
const floor=new THREE.Mesh(
new THREE.PlaneGeometry(300,300),matWhite
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

/* Spawn Corridor */
wall(0,5,40,10,10,1,matBlue);
wall(-5,5,25,1,10,30,matYellow);
wall(5,5,25,1,10,30,matYellow);
wall(0,9,25,10,1,30,matWhite);

/* Door */
let mainDoor=new THREE.Mesh(
new THREE.BoxGeometry(8,8,1),matDark
);
mainDoor.position.set(0,4,10);
scene.add(mainDoor);
addCollider(mainDoor);

let doorOpened=false;

/* Atrium outer */
wall(0,5,-40,80,10,1,matBlue);
wall(-40,5,0,1,10,80,matBlue);
wall(40,5,0,1,10,80,matBlue);
wall(0,9,0,80,1,80,matWhite);

/* Player */
player=new THREE.Object3D();
player.position.set(0,2,35); // SAFE SPAWN
scene.add(player);
player.add(camera);

crosshair.style.display="block";

/* Controls */
document.addEventListener("mousemove",(e)=>{
if(document.pointerLockElement===renderer.domElement){
yaw-=e.movementX*0.002;
pitch-=e.movementY*0.002;
pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch));
player.rotation.y=yaw;
camera.rotation.x=pitch;
}
});

document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);

function animate(){
requestAnimationFrame(animate);

let time=performance.now();
let delta=(time-prevTime)/1000;
prevTime=time;

let forward=new THREE.Vector3();
camera.getWorldDirection(forward);
forward.y=0;
forward.normalize();

let right=new THREE.Vector3();
right.crossVectors(forward,new THREE.Vector3(0,1,0)).normalize();

let moveDir=new THREE.Vector3();
if(keys["KeyW"]) moveDir.add(forward);
if(keys["KeyS"]) moveDir.sub(forward);
if(keys["KeyA"]) moveDir.sub(right);
if(keys["KeyD"]) moveDir.add(right);
moveDir.normalize();

let speed=keys["ShiftLeft"]?14:8;

let newPos=player.position.clone();
newPos.addScaledVector(moveDir,speed*delta);

if(!checkCollision(newPos)){
player.position.x=newPos.x;
player.position.z=newPos.z;
}

velocityY-=30*delta;
if(keys["Space"] && canJump){
velocityY=12;
canJump=false;
}
player.position.y+=velocityY*delta;
if(player.position.y<=2){
player.position.y=2;
velocityY=0;
canJump=true;
}

if(!doorOpened && player.position.z<30){
doorOpened=true;
}
if(doorOpened && mainDoor.position.y<20){
mainDoor.position.y+=12*delta;
}

renderer.render(scene,camera);
}
animate();

}

/* Resize */
window.addEventListener("resize",()=>{
if(camera && renderer){
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
}
});

</script>
</body>
</html>
