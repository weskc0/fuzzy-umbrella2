<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Playcare</title>

<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }

#overlay {
position:absolute;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.95);
color:white;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
font-size:32px;
cursor:pointer;
z-index:100;
text-align:center;
}

#ui {
position:absolute;
bottom:20px;
left:20px;
color:white;
font-size:16px;
z-index:50;
opacity:0.8;
}
</style>
</head>
<body>

<div id="overlay">
PROJECT PLAYCARE<br>
<div style="font-size:18px; opacity:0.6; margin-top:15px;">
Click To Enter
</div>
</div>

<div id="ui">
Flashlight: OFF (Press F)
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>

/* ================= SCENE ================= */

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x050509);
scene.fog = new THREE.Fog(0x050509, 10, 120);

const camera = new THREE.PerspectiveCamera(
75,
window.innerWidth / window.innerHeight,
0.1,
1000
);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* ================= LIGHTING ================= */

const ambient = new THREE.AmbientLight(0xffffff, 0.05);
scene.add(ambient);

/* FLASHLIGHT */
const flashlight = new THREE.SpotLight(0xffffff, 0);
flashlight.angle = Math.PI / 8;
flashlight.penumbra = 0.5;
flashlight.decay = 1.5;
flashlight.distance = 150;
flashlight.castShadow = false;

camera.add(flashlight);
camera.add(flashlight.target);
flashlight.position.set(0,0,0);
flashlight.target.position.set(0,0,-1);
scene.add(camera);

let flashlightOn = false;

/* ================= FLOOR ================= */

const floor = new THREE.Mesh(
new THREE.PlaneGeometry(300,300),
new THREE.MeshStandardMaterial({ color:0x111111 })
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

/* TEST OBJECT */

const cube = new THREE.Mesh(
new THREE.BoxGeometry(3,3,3),
new THREE.MeshStandardMaterial({ color:0xaa0000 })
);
cube.position.set(0,1.5,-30);
scene.add(cube);

/* ================= PLAYER ================= */

const player = new THREE.Object3D();
player.position.set(0,2,10);
scene.add(player);
player.add(camera);

let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();

let moveSpeed = 4;
let sprintSpeed = 7;
let gravity = 20;
let jumpForce = 8;

let canJump = false;
let keys = {};

/* ================= INPUT ================= */

document.addEventListener("keydown", e => {

keys[e.code] = true;

if(e.code === "KeyF"){
flashlightOn = !flashlightOn;
flashlight.intensity = flashlightOn ? 3 : 0;
document.getElementById("ui").innerText =
"Flashlight: " + (flashlightOn ? "ON (Press F)" : "OFF (Press F)");
}

});

document.addEventListener("keyup", e => keys[e.code] = false);

/* ================= POINTER LOCK ================= */

const overlay = document.getElementById("overlay");

overlay.addEventListener("click", () => {
renderer.domElement.requestPointerLock();
});

document.addEventListener("pointerlockchange", () => {
if(document.pointerLockElement === renderer.domElement){
overlay.style.display = "none";
} else {
overlay.style.display = "flex";
}
});

/* ================= MOUSE LOOK ================= */

let yaw = 0;
let pitch = 0;

document.addEventListener("mousemove", (event) => {
if(document.pointerLockElement === renderer.domElement){

yaw -= event.movementX * 0.002;
pitch -= event.movementY * 0.002;

pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));

player.rotation.y = yaw;
camera.rotation.x = pitch;

}
});

/* ================= MOVEMENT ================= */

let prevTime = performance.now();

function animate(){
requestAnimationFrame(animate);

const time = performance.now();
const delta = (time - prevTime) / 1000;
prevTime = time;

/* Direction */
direction.set(0,0,0);
if(keys["KeyW"]) direction.z -= 1;
if(keys["KeyS"]) direction.z += 1;
if(keys["KeyA"]) direction.x -= 1;
if(keys["KeyD"]) direction.x += 1;
direction.normalize();

/* Speed */
let speed = (keys["ShiftLeft"] || keys["ShiftRight"]) ? sprintSpeed : moveSpeed;

/* Velocity */
velocity.x = direction.x * speed;
velocity.z = direction.z * speed;
velocity.y -= gravity * delta;

/* Jump */
if(keys["Space"] && canJump){
velocity.y = jumpForce;
canJump = false;
}

/* Move */
player.translateX(velocity.x * delta);
player.translateZ(velocity.z * delta);
player.position.y += velocity.y * delta;

/* Floor collision */
if(player.position.y < 2){
velocity.y = 0;
player.position.y = 2;
canJump = true;
}

/* Flashlight flicker */
if(flashlightOn){
flashlight.intensity = 2.8 + Math.random() * 0.4;
}

/* Animate cube */
cube.rotation.y += 0.6 * delta;

renderer.render(scene, camera);
}

animate();

/* ================= RESIZE ================= */

window.addEventListener("resize", () => {
camera.aspect = window.innerWidth / window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth, window.innerHeight);
});

</script>

</body>
</html>
