<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Playcare</title>
<style>
body{margin:0;overflow:hidden;background:black;font-family:Arial}
#title,#ending{
position:absolute;width:100%;height:100%;
display:flex;flex-direction:column;
align-items:center;justify-content:center;
background:black;color:white;z-index:20
}
#title h1{font-size:48px;margin:0}
button{padding:12px 25px;margin-top:20px;font-size:18px;cursor:pointer}
#healthBox{
position:absolute;top:20px;left:20px;
width:220px;height:22px;border:2px solid white;
display:none
}
#healthBar{height:100%;width:100%;background:red}
#crosshair{
position:absolute;top:50%;left:50%;
width:6px;height:6px;background:white;
transform:translate(-50%,-50%);
display:none
}
#flash{
position:absolute;width:100%;height:100%;
background:red;opacity:0;pointer-events:none;
transition:opacity .1s;
}
</style>
</head>
<body>

<div id="title">
<h1>PROJECT PLAYCARE</h1>
<button id="start">START</button>
</div>

<div id="ending" style="display:none;">
<h1>SEE YOU SOON</h1>
</div>

<div id="healthBox"><div id="healthBar"></div></div>
<div id="crosshair"></div>
<div id="flash"></div>

<audio id="titleMusic" src="Title music.mp3" loop></audio>
<audio id="hallMusic" src="Bgm-1.mp3" loop></audio>
<audio id="bossMusic" src="chase music.mp3" loop></audio>
<audio id="protoMusic" src="Prototype encounter music.mp3" loop></audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>

let scene,camera,renderer,player,catnap,generator,arenaDoor,protoDoor
let state="title"
let health=100
let batteries=0
let keys={}
let yaw=0,pitch=0
let velocityY=0
let bossDoorOpen=false
let protoTimer=0

const titleUI=document.getElementById("title")
const endingUI=document.getElementById("ending")
const healthBar=document.getElementById("healthBar")
const healthBox=document.getElementById("healthBox")
const crosshair=document.getElementById("crosshair")
const flash=document.getElementById("flash")

const titleMusic=document.getElementById("titleMusic")
const hallMusic=document.getElementById("hallMusic")
const bossMusic=document.getElementById("bossMusic")
const protoMusic=document.getElementById("protoMusic")

function fadeIn(a,v=1,d=2000){
a.volume=0;a.play()
let step=v/(d/50)
let i=setInterval(()=>{
a.volume=Math.min(v,a.volume+step)
if(a.volume>=v)clearInterval(i)
},50)
}
function fadeOut(a,d=2000){
let step=a.volume/(d/50)
let i=setInterval(()=>{
a.volume=Math.max(0,a.volume-step)
if(a.volume<=0){a.pause();clearInterval(i)}
},50)
}

fadeIn(titleMusic)

document.getElementById("start").onclick=()=>{
fadeOut(titleMusic)
titleUI.style.display="none"
init()
}

function init(){

scene=new THREE.Scene()
scene.fog=new THREE.Fog(0x220000,10,180)

camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,2000)
renderer=new THREE.WebGLRenderer({antialias:true})
renderer.setSize(innerWidth,innerHeight)
document.body.appendChild(renderer.domElement)
renderer.domElement.requestPointerLock=renderer.domElement.requestPointerLock||renderer.domElement.mozRequestPointerLock
renderer.domElement.addEventListener("click",()=>renderer.domElement.requestPointerLock())

scene.add(new THREE.AmbientLight(0xff0000,.3))
let light=new THREE.PointLight(0xff0000,2,60)
light.position.set(0,8,0)
scene.add(light)

const wallMat=new THREE.MeshStandardMaterial({color:0x333333})
const floorMat=new THREE.MeshStandardMaterial({color:0x222222})

function wall(x,y,z,w,h,d){
let m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),wallMat)
m.position.set(x,y,z)
scene.add(m)
}

function floor(x,z,w,d){
let m=new THREE.Mesh(new THREE.BoxGeometry(w,1,d),floorMat)
m.position.set(x,-0.5,z)
scene.add(m)
}

/* BUILDING HALLWAY */
floor(0,-60,20,200)
wall(-10,5,-60,1,10,200)
wall(10,5,-60,1,10,200)
wall(0,10,-60,20,1,200)

/* BOSS DOOR */
arenaDoor=new THREE.Mesh(new THREE.BoxGeometry(8,8,1),wallMat)
arenaDoor.position.set(0,4,-150)
scene.add(arenaDoor)

/* ARENA */
floor(0,-220,60,60)
wall(-30,5,-220,1,10,60)
wall(30,5,-220,1,10,60)
wall(0,10,-220,60,1,60)
wall(0,5,-250,60,10,1)

/* GENERATOR */
generator=new THREE.Mesh(new THREE.CylinderGeometry(4,4,8,16),
new THREE.MeshStandardMaterial({color:0x00ffff}))
generator.position.set(0,4,-220)
scene.add(generator)

/* BATTERIES */
for(let i=0;i<4;i++){
let b=new THREE.Mesh(new THREE.BoxGeometry(2,2,2),
new THREE.MeshStandardMaterial({color:0xffff00}))
b.position.set((Math.random()-0.5)*40,1,-220+(Math.random()-0.5)*40)
b.userData.battery=true
scene.add(b)
}

/* PROTOTYPE ROOM */
protoDoor=new THREE.Mesh(new THREE.BoxGeometry(8,8,1),wallMat)
protoDoor.position.set(0,4,-260)
scene.add(protoDoor)

/* PROTOTYPE HAND */
let hand=new THREE.Mesh(new THREE.BoxGeometry(6,2,8),
new THREE.MeshStandardMaterial({color:0x555555}))
hand.position.set(0,2,-280)
scene.add(hand)

/* PROTOTYPE EYE */
let eye=new THREE.Mesh(new THREE.SphereGeometry(2,16,16),
new THREE.MeshBasicMaterial({color:0xffff00}))
eye.position.set(0,4,-295)
scene.add(eye)

/* PLAYER */
player=new THREE.Object3D()
player.position.set(0,2,20)
scene.add(player)
player.add(camera)

healthBox.style.display="block"
crosshair.style.display="block"

fadeIn(hallMusic,.6)
state="hall"

/* CATNAP */
let body=new THREE.Mesh(new THREE.BoxGeometry(4,8,4),
new THREE.MeshStandardMaterial({color:0x2a0033}))
let head=new THREE.Mesh(new THREE.BoxGeometry(4,4,4),
new THREE.MeshStandardMaterial({color:0x2a0033}))
head.position.y=6
body.add(head)
let eyeL=new THREE.Mesh(new THREE.SphereGeometry(.5,8,8),
new THREE.MeshBasicMaterial({color:0xffffff}))
let eyeR=eyeL.clone()
eyeL.position.set(-1,6.5,2.2)
eyeR.position.set(1,6.5,2.2)
body.add(eyeL);body.add(eyeR)
catnap=body
catnap.position.set(0,4,40)
scene.add(catnap)

animate()
}

/* CONTROLS */
document.addEventListener("mousemove",e=>{
if(document.pointerLockElement===renderer.domElement){
yaw-=e.movementX*.002
pitch-=e.movementY*.002
pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch))
player.rotation.y=yaw
camera.rotation.x=pitch
}})
document.addEventListener("keydown",e=>keys[e.code]=true)
document.addEventListener("keyup",e=>keys[e.code]=false)

function animate(){
requestAnimationFrame(animate)
if(!scene)return
let delta=.016

/* movement */
let forward=new THREE.Vector3()
camera.getWorldDirection(forward);forward.y=0;forward.normalize()
let right=new THREE.Vector3()
right.crossVectors(forward,new THREE.Vector3(0,1,0)).normalize()
let move=new THREE.Vector3()
if(keys["KeyW"])move.add(forward)
if(keys["KeyS"])move.sub(forward)
if(keys["KeyA"])move.sub(right)
if(keys["KeyD"])move.add(right)
move.normalize()
player.position.addScaledVector(move,8*delta)

/* jump */
velocityY-=30*delta
if(keys["Space"]&&player.position.y<=2)velocityY=12
player.position.y+=velocityY*delta
if(player.position.y<2){player.position.y=2;velocityY=0}

/* catnap chase */
if(state!=="ending"){
let dir=new THREE.Vector3().subVectors(player.position,catnap.position).normalize()
catnap.position.addScaledVector(dir,5*delta)
catnap.lookAt(player.position)
if(catnap.position.distanceTo(player.position)<3){
health-=.6
healthBar.style.width=health+"%"
flash.style.opacity=.4
setTimeout(()=>flash.style.opacity=0,100)
}
}

/* door opening */
if(player.position.z<-145 && !bossDoorOpen){
arenaDoor.position.y+=10*delta
if(arenaDoor.position.y>20){
bossDoorOpen=true
fadeOut(hallMusic)
fadeIn(bossMusic,.8)
state="boss"
}
}

/* boss mechanics */
if(state==="boss"){
scene.children.forEach(o=>{
if(o.userData.battery && o.position.distanceTo(player.position)<3){
scene.remove(o);batteries++
}
})
if(batteries>0 && player.position.distanceTo(generator.position)<6){
if(keys["KeyE"]){
batteries--
generator.material.color.set(0x00ff00)
}
}
if(batteries===0 && generator.material.color.getHex()===0x00ff00){
catnap.visible=false
bossMusic.pause()
protoDoor.position.y+=20*delta
if(protoDoor.position.y>20){
state="proto"
fadeIn(protoMusic,.6)
}
}
}

/* prototype */
if(state==="proto"){
protoTimer+=delta
if(protoTimer>10){
endingUI.style.display="flex"
state="ending"
}
}

if(health<=0)location.reload()

renderer.render(scene,camera)
}

window.addEventListener("resize",()=>{
camera.aspect=innerWidth/innerHeight
camera.updateProjectionMatrix()
renderer.setSize(innerWidth,innerHeight)
})

</script>
</body>
</html>
