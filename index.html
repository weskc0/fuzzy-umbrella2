<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PROJECT: PLAYCARE – NIGHT SHIFT</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  font-family:Arial, system-ui, sans-serif;
  color:white;
  user-select:none;
}

/* CANVAS BACKDROP */
#gameCanvas{
  position:fixed;
  inset:0;
  background:#05050a;
}

/* TITLE SCREEN */
#titleScreen{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at 50% 20%, #161626 0, #050511 45%, #000 100%);
  z-index:30;
}
#titleBackdrop{
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 10% 10%, rgba(255,0,0,0.12) 0, transparent 45%),
    radial-gradient(circle at 80% 80%, rgba(0,140,255,0.2) 0, transparent 55%);
  pointer-events:none;
}
#titleContent{
  position:relative;
  text-align:center;
}
#titleLogo{
  margin:0;
  text-transform:uppercase;
  letter-spacing:8px;
}
#titleLogo span:nth-child(1){
  display:block;
  font-size:18px;
  color:#ff4a4a;
}
#titleLogo span:nth-child(2){
  display:block;
  font-size:40px;
}
#titleTagline{
  margin-top:6px;
  font-size:13px;
  opacity:.8;
  animation:tagPulse 3s ease-in-out infinite;
}
@keyframes tagPulse{
  0%,100%{opacity:.45;}
  50%{opacity:1;}
}
#titleButtons{
  margin-top:26px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.titleBtn{
  padding:10px 32px;
  font-size:15px;
  letter-spacing:2px;
  text-transform:uppercase;
  border:none;
  border-radius:4px;
  cursor:pointer;
  background:#ff2222;
  color:white;
  box-shadow:0 0 14px rgba(0,0,0,0.5);
  transition:background .15s,transform .1s,box-shadow .15s;
}
.titleBtn:hover{
  background:#ff4444;
  transform:translateY(-1px);
  box-shadow:0 0 22px rgba(255,60,60,0.6);
}

/* SETTINGS (simple for now) */
#settingsPanel{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:320px;
  padding:16px 18px;
  background:rgba(3,4,10,0.95);
  border:1px solid #444;
  box-shadow:0 0 22px rgba(0,0,0,0.9);
  display:none;
  z-index:35;
}
#settingsPanel h2{
  margin:0 0 10px 0;
  font-size:18px;
  letter-spacing:2px;
}
.settingRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:8px 0;
  font-size:13px;
}
.settingRow input[type=range]{width:170px;}
.settingRow input[type=checkbox]{transform:scale(1.1);}
#settingsClose{
  margin-top:12px;
  padding:6px 14px;
  font-size:13px;
  border:none;
  border-radius:4px;
  background:#444;
  color:white;
  cursor:pointer;
}
#settingsClose:hover{background:#666;}

/* HUD */
#hud{
  position:absolute;
  left:20px;
  bottom:20px;
  color:white;
  font-size:14px;
  text-shadow:0 0 4px #000;
  z-index:10;
  white-space:pre-line;
  display:none;
}
#info{
  position:absolute;
  right:20px;
  bottom:20px;
  color:white;
  font-size:13px;
  text-shadow:0 0 4px #000;
  z-index:10;
  text-align:right;
  display:none;
}
#timeDisplay{
  position:absolute;
  top:20px;
  right:20px;
  font-size:16px;
  text-shadow:0 0 4px #000;
  z-index:10;
  display:none;
}
#powerBar{
  position:absolute;
  left:20px;
  top:20px;
  width:140px;
  height:18px;
  border:1px solid #fff;
  z-index:10;
  display:none;
}
#powerFill{
  height:100%;
  width:100%;
  background:#46ff46;
}

/* OFFICE UI clickable regions */
.uiButton{
  position:absolute;
  border:2px solid #666;
  background:rgba(20,20,30,0.8);
  color:white;
  font-size:11px;
  padding:4px 6px;
  cursor:pointer;
  text-align:center;
  user-select:none;
}
.uiButton.on{
  background:#ff4444;
}
#leftDoorBtn{left:40px;bottom:80px;}
#leftLightBtn{left:40px;bottom:50px;}
#rightDoorBtn{right:40px;bottom:80px;}
#rightLightBtn{right:40px;bottom:50px;}
#camBtn{left:50%;bottom:30px;transform:translateX(-50%);}

/* CAMERA MONITOR OVERLAY */
#camOverlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.85);
  display:none;
  z-index:20;
}
#camView{
  position:absolute;
  left:50%;
  top:50%;
  width:480px;
  height:270px;
  transform:translate(-50%,-50%);
  background:#050509;
  border:2px solid #666;
  box-shadow:0 0 12px rgba(0,0,0,0.8);
}
#camLabel{
  position:absolute;
  top:-22px;
  left:0;
  font-size:12px;
  color:#ccc;
}
.camMap{
  position:absolute;
  bottom:-80px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:6px;
}
.camMap button{
  padding:3px 8px;
  font-size:11px;
  background:#222;
  border:1px solid #555;
  color:white;
  cursor:pointer;
}
.camMap button.active{
  background:#66ccff;
  border-color:#aaf;
}

/* Jumpscare & 6 AM */
#jumpscare{
  position:absolute;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:black;
  color:white;
  z-index:40;
  font-size:32px;
  letter-spacing:4px;
}
#sixAM{
  position:absolute;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:black;
  color:white;
  z-index:40;
  font-size:32px;
  letter-spacing:4px;
}
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<!-- TITLE SCREEN -->
<div id="titleScreen">
  <div id="titleBackdrop"></div>
  <div id="titleContent">
    <h1 id="titleLogo">
      <span>PROJECT:</span>
      <span>PLAYCARE</span>
    </h1>
    <div id="titleTagline">Night Shift – “Everyone disappeared. They’re still here.”</div>
    <div id="titleButtons">
      <button class="titleBtn" id="playBtn">New Game</button>
      <button class="titleBtn" id="settingsBtn">Settings</button>
      <button class="titleBtn" id="quitBtn">Quit</button>
    </div>
  </div>
</div>

<!-- SETTINGS -->
<div id="settingsPanel">
  <h2>SETTINGS</h2>
  <div class="settingRow">
    <span>Master Volume</span>
    <input id="volumeSlider" type="range" min="0" max="100" value="75">
  </div>
  <div class="settingRow">
    <span>Mouse Sensitivity</span>
    <input id="sensSlider" type="range" min="20" max="200" value="80">
  </div>
  <div class="settingRow">
    <span>Flashlight Enabled</span>
    <input id="flashToggle" type="checkbox" checked>
  </div>
  <button id="settingsClose">Back</button>
</div>

<!-- HUD -->
<div id="hud"></div>
<div id="info"></div>
<div id="timeDisplay"></div>
<div id="powerBar"><div id="powerFill"></div></div>

<!-- Office buttons -->
<div id="leftDoorBtn" class="uiButton">LEFT DOOR</div>
<div id="leftLightBtn" class="uiButton">LEFT LIGHT</div>
<div id="rightDoorBtn" class="uiButton">RIGHT DOOR</div>
<div id="rightLightBtn" class="uiButton">RIGHT LIGHT</div>
<div id="camBtn" class="uiButton">CAM</div>

<!-- Camera overlay -->
<div id="camOverlay">
  <div id="camView">
    <div id="camLabel">CAM 1 – STAGE</div>
    <!-- Placeholder: we just draw into canvas for now -->
  </div>
  <div class="camMap">
    <button data-cam="1" class="camBtn">CAM 1</button>
    <button data-cam="2" class="camBtn">CAM 2</button>
    <button data-cam="3" class="camBtn">CAM 3</button>
    <button data-cam="4" class="camBtn">CAM 4</button>
  </div>
</div>

<!-- Jumpscare / 6AM -->
<div id="jumpscare">HUGGY GOT YOU</div>
<div id="sixAM">6 AM</div>

<!-- AUDIO -->
<audio id="titleMusic" src="Title music.mp3" loop></audio>
<audio id="officeMusic" src="Bgm-1.mp3" loop></audio>
<audio id="chaseMusic" src="chase music.mp3" loop></audio>
<audio id="protoMusic" src="Prototype encounter music.mp3" loop></audio>
<audio id="jumpscareSound" src="jumpscare.mp3"></audio>

<script>
// ===== SIMPLE 2D OFFICE USING CANVAS (no pointer lock) =====
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ===== UI refs =====
const titleScreen = document.getElementById('titleScreen');
const playBtn = document.getElementById('playBtn');
const settingsBtn = document.getElementById('settingsBtn');
const quitBtn = document.getElementById('quitBtn');
const settingsPanel = document.getElementById('settingsPanel');
const settingsClose = document.getElementById('settingsClose');
const volumeSlider = document.getElementById('volumeSlider');
const sensSlider = document.getElementById('sensSlider');
const flashToggle = document.getElementById('flashToggle');

const titleMusic = document.getElementById('titleMusic');
const officeMusic = document.getElementById('officeMusic');
const chaseMusic = document.getElementById('chaseMusic');
const protoMusic = document.getElementById('protoMusic');
const jumpscareSound = document.getElementById('jumpscareSound');

const hud = document.getElementById('hud');
const info = document.getElementById('info');
const timeDisplay = document.getElementById('timeDisplay');
const powerBar = document.getElementById('powerBar');
const powerFill = document.getElementById('powerFill');

const leftDoorBtn = document.getElementById('leftDoorBtn');
const leftLightBtn = document.getElementById('leftLightBtn');
const rightDoorBtn = document.getElementById('rightDoorBtn');
const rightLightBtn = document.getElementById('rightLightBtn');
const camBtn = document.getElementById('camBtn');

const camOverlay = document.getElementById('camOverlay');
const camLabel = document.getElementById('camLabel');
const camButtons = Array.from(document.querySelectorAll('.camBtn'));

const jumpscareDiv = document.getElementById('jumpscare');
const sixAMDiv = document.getElementById('sixAM');

// ===== OPTIONS =====
const options = {
  masterVolume: 0.75,
  mouseSensitivity: 0.0025,
  flashlightEnabled: true
};

function fadeIn(audio,target=0.75,duration=1500){
  audio.volume = 0;
  audio.play().catch(()=>{});
  const step = target/(duration/50);
  const id = setInterval(()=>{
    audio.volume = Math.min(target, audio.volume+step);
    if(audio.volume>=target) clearInterval(id);
  },50);
}
function fadeOut(audio,duration=1500){
  const step = (audio.volume||0)/(duration/50||1);
  const id = setInterval(()=>{
    audio.volume = Math.max(0, audio.volume-step);
    if(audio.volume<=0){audio.pause();clearInterval(id);}
  },50);
}
function stopAllMusic(){
  [titleMusic,officeMusic,chaseMusic,protoMusic].forEach(a=>{a.pause();a.currentTime=0;});
}
function applyMasterVolume(){
  [titleMusic,officeMusic,chaseMusic,protoMusic,jumpscareSound].forEach(a=>{a.volume=options.masterVolume;});
}

// init title music
applyMasterVolume();
fadeIn(titleMusic, options.masterVolume);

volumeSlider.addEventListener('input',()=>{
  options.masterVolume = Number(volumeSlider.value)/100;
  applyMasterVolume();
});
sensSlider.addEventListener('input',()=>{
  const v = Number(sensSlider.value);
  options.mouseSensitivity = 0.001 + (v-20)*(0.01-0.001)/(200-20);
});
flashToggle.addEventListener('change',()=>{
  options.flashlightEnabled = flashToggle.checked;
});

// settings UI
settingsBtn.onclick = ()=> settingsPanel.style.display='block';
settingsClose.onclick = ()=> settingsPanel.style.display='none';
quitBtn.onclick = ()=>{
  titleScreen.style.display='none';
  fadeOut(titleMusic,800);
};

// ===== GAME STATE (FNaw style) =====
const game = {
  running: false,
  night: 1,
  hour: 12,
  minute: 0,
  timeScale: 10, // 1 in-game minute = 10 real seconds
  lastMinuteTick: 0,
  power: 100,
  powerDrainBase: 0.03, // % per second
  powerDrainDoors: 0.2,
  powerDrainLights: 0.1,

  officeView: 'center', // 'left','center','right'
  camsOpen: false,
  currentCam: 1,
  leftDoorClosed: false,
  rightDoorClosed: false,
  leftLightOn: false,
  rightLightOn: false,

  anim: {
    huggy: { state: 'stage', lastMove: 0, moveDelay: 6 }, // states: stage→hall→door
  },
  state: 'office', // 'office','jumpscare','win'
  startTime: 0
};

// Night rules for Huggy (Bonnie)
const huggyPath = ['stage','hall1','door'];

// ===== INPUT: Office buttons =====
leftDoorBtn.onclick = ()=>{
  if(!game.running || game.state!=='office') return;
  game.leftDoorClosed = !game.leftDoorClosed;
  leftDoorBtn.classList.toggle('on', game.leftDoorClosed);
};
leftLightBtn.onclick = ()=>{
  if(!game.running || game.state!=='office') return;
  game.leftLightOn = !game.leftLightOn;
  leftLightBtn.classList.toggle('on', game.leftLightOn);
};
rightDoorBtn.onclick = ()=>{
  if(!game.running || game.state!=='office') return;
  game.rightDoorClosed = !game.rightDoorClosed;
  rightDoorBtn.classList.toggle('on', game.rightDoorClosed);
};
rightLightBtn.onclick = ()=>{
  if(!game.running || game.state!=='office') return;
  game.rightLightOn = !game.rightLightOn;
  rightLightBtn.classList.toggle('on', game.rightLightOn);
};
camBtn.onclick = ()=>{
  if(!game.running || game.state!=='office') return;
  game.camsOpen = !game.camsOpen;
  camOverlay.style.display = game.camsOpen ? 'block':'none';
};

camButtons.forEach(btn=>{
  btn.onclick = ()=>{
    if(!game.camsOpen || game.state!=='office') return;
    const camId = Number(btn.dataset.cam);
    game.currentCam = camId;
    camButtons.forEach(b=>b.classList.toggle('active', Number(b.dataset.cam)===camId));
    updateCamLabel();
  };
});

function updateCamLabel(){
  let name = '';
  switch(game.currentCam){
    case 1: name='CAM 1 – STAGE';break;
    case 2: name='CAM 2 – LEFT HALL';break;
    case 3: name='CAM 3 – RIGHT HALL';break;
    case 4: name='CAM 4 – CATNAP COVE (stub)';break;
  }
  camLabel.textContent = name;
}

// ===== TITLE START =====
playBtn.onclick = ()=>{
  titleScreen.style.display='none';
  settingsPanel.style.display='none';
  fadeOut(titleMusic,800);
  startNight(1);
};

// ===== NIGHT SETUP =====
function startNight(n){
  game.running = true;
  game.night = n;
  game.hour = 12;
  game.minute = 0;
  game.lastMinuteTick = performance.now();
  game.power = 100;
  game.state = 'office';
  game.officeView = 'center';
  game.camsOpen = false;
  game.currentCam = 1;
  game.leftDoorClosed = false;
  game.rightDoorClosed = false;
  game.leftLightOn = false;
  game.rightLightOn = false;

  // Huggy reset
  game.anim.huggy.state = 'stage';
  game.anim.huggy.lastMove = performance.now();
  game.anim.huggy.moveDelay = 6; // seconds

  hud.style.display='block';
  info.style.display='block';
  timeDisplay.style.display='block';
  powerBar.style.display='block';
  camOverlay.style.display='none';
  camButtons.forEach(b=>b.classList.toggle('active', Number(b.dataset.cam)===1));
  updateCamLabel();
  jumpscareDiv.style.display='none';
  sixAMDiv.style.display='none';

  stopAllMusic();
  applyMasterVolume();
  fadeIn(officeMusic, options.masterVolume);

  requestAnimationFrame(loop);
}

// ===== MAIN LOOP =====
function loop(now){
  if(!game.running) return;

  const dt = 0.016; // rough fixed timestep

  updateTime(now);
  updatePower(dt);
  updateHuggy(now);
  checkWinLose(now);
  drawOffice();
  drawCamView();

  requestAnimationFrame(loop);
}

// ===== TIME & POWER =====
function updateTime(now){
  const elapsed = (now - game.lastMinuteTick)/1000;
  if(elapsed >= game.timeScale){
    game.lastMinuteTick = now;
    game.minute += 1;
    if(game.minute>=60){
      game.minute=0;
      game.hour++;
      if(game.hour===13) game.hour=1; // just in case
    }
  }
  timeDisplay.textContent = `${game.hour} AM`;
}

function updatePower(dt){
  if(game.state!=='office') return;
  let drain = game.powerDrainBase;
  if(game.leftDoorClosed) drain += game.powerDrainDoors;
  if(game.rightDoorClosed) drain += game.powerDrainDoors;
  if(game.leftLightOn) drain += game.powerDrainLights;
  if(game.rightLightOn) drain += game.powerDrainLights;
  if(game.camsOpen) drain += 0.05;

  game.power -= drain*dt*60; // scale up a bit
  if(game.power<0) game.power=0;
  powerFill.style.width = `${game.power}%`;
  if(game.power<30) powerFill.style.background='#ffcc33';
  if(game.power<15) powerFill.style.background='#ff4444';
}

// ===== HUGGY AI (Night 1) =====
function updateHuggy(now){
  if(game.night!==1 || game.state!=='office') return;
  const h = game.anim.huggy;
  const t = now/1000;
  if(t - h.lastMove < h.moveDelay) return;

  // If cams open and you are looking at Huggy's current cam, slow him down
  const watchingHuggy = game.camsOpen && (
    (h.state==='stage' && game.currentCam===1) ||
    (h.state==='hall1' && game.currentCam===2) ||
    (h.state==='door' && game.currentCam===2)
  );
  if(watchingHuggy){
    h.moveDelay = 8; // slower if watched
  }else{
    h.moveDelay = 5; // faster if ignored
  }

  // Move along path
  const idx = huggyPath.indexOf(h.state);
  if(idx < huggyPath.length-1){
    h.state = huggyPath[idx+1];
    h.lastMove = t;
  }else{
    // at door: check door status
    if(!game.leftDoorClosed){
      // Jumpscare
      triggerHuggyJumpscare();
    }else{
      // door protected you; reset him to earlier state
      h.state = 'hall1';
      h.lastMove = t;
    }
  }
}

// ===== JUMPSCARE & WIN =====
function triggerHuggyJumpscare(){
  if(game.state!=='office') return;
  game.state = 'jumpscare';
  stopAllMusic();
  applyMasterVolume();
  if(jumpscareSound){
    jumpscareSound.currentTime=0;
    jumpscareSound.play().catch(()=>{});
  }
  jumpscareDiv.style.display='flex';
  setTimeout(()=>{
    game.running=false;
  },2500);
}

function checkWinLose(now){
  // Powerout lose condition can be added later
  if(game.hour>=6){
    if(game.state==='office'){
      game.state='win';
      stopAllMusic();
      sixAMDiv.style.display='flex';
      setTimeout(()=>{
        game.running=false;
      },3000);
    }
  }
}

// ===== DRAWING =====
function drawOffice(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Basic office background
  const w = canvas.width;
  const h = canvas.height;
  ctx.fillStyle = '#101420';
  ctx.fillRect(0,0,w,h);

  // Desk
  ctx.fillStyle='#181c28';
  ctx.fillRect(w*0.2,h*0.65,w*0.6,h*0.1);

  // Left door area
  ctx.fillStyle = game.leftDoorClosed ? '#303340' : '#05070b';
  ctx.fillRect(0,h*0.3,w*0.2,h*0.4);

  // Right door area
  ctx.fillStyle = game.rightDoorClosed ? '#303340' : '#05070b';
  ctx.fillRect(w*0.8,h*0.3,w*0.2,h*0.4);

  // Left hallway light effect
  if(game.leftLightOn){
    ctx.fillStyle='rgba(200,200,255,0.4)';
    ctx.fillRect(0,h*0.3,w*0.2,h*0.4);
  }
  // Right hallway light effect
  if(game.rightLightOn){
    ctx.fillStyle='rgba(200,200,255,0.4)';
    ctx.fillRect(w*0.8,h*0.3,w*0.2,h*0.4);
  }

  // Draw Huggy silhouette if near door
  const hState = game.anim.huggy.state;
  if(hState==='hall1'){
    // show in left hall
    ctx.fillStyle='#0033aa';
    ctx.fillRect(w*0.06,h*0.35,40,120); // placeholder
  }else if(hState==='door'){
    // show at left doorway
    ctx.fillStyle='#0055ff';
    ctx.fillRect(w*0.02,h*0.35,60,150); // closer
  }

  // HUD text
  hud.textContent = `Night ${game.night}\nHuggy state: ${game.anim.huggy.state}`;
}

// Cam view placeholder
function drawCamView(){
  if(!game.camsOpen) return;
  const vw = 480, vh=270;
  const cx = canvas.width/2 - vw/2;
  const cy = canvas.height/2 - vh/2;

  ctx.save();
  ctx.strokeStyle='#666';
  ctx.strokeRect(cx,cy,vw,vh);

  ctx.fillStyle='#05050a';
  ctx.fillRect(cx,cy,vw,vh);

  ctx.font='14px Arial';
  ctx.fillStyle='#ddd';

  if(game.currentCam===1){
    ctx.fillText('CAM 1 – STAGE (Huggy idle)',cx+20,cy+30);
    ctx.fillStyle='#0033aa';
    ctx.fillRect(cx+vw/2-30,cy+vh/2-60,60,120); // Huggy at stage
  }else if(game.currentCam===2){
    ctx.fillText('CAM 2 – LEFT HALL',cx+20,cy+30);
    if(game.anim.huggy.state==='hall1' || game.anim.huggy.state==='door'){
      ctx.fillStyle='#0033aa';
      ctx.fillRect(cx+vw*0.6,cy+vh*0.5-60,50,120);
    }
  }else if(game.currentCam===3){
    ctx.fillText('CAM 3 – RIGHT HALL (stub)',cx+20,cy+30);
  }else if(game.currentCam===4){
    ctx.fillText('CAM 4 – CATNAP COVE (stub)',cx+20,cy+30);
  }

  ctx.restore();
}
</script>
</body>
</html>
