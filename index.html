<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Project Playcare</title>

<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }

/* ===== TITLE SCREEN ===== */
#titleScreen {
position:absolute;
width:100%;
height:100%;
background:black;
color:white;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:200;
text-align:center;
}

#titleScreen h1 {
font-size:60px;
margin:0;
}

#startBtn {
margin-top:30px;
padding:15px 40px;
font-size:20px;
cursor:pointer;
background:white;
border:none;
}

/* ===== LOADING SCREEN ===== */
#loadingScreen {
position:absolute;
width:100%;
height:100%;
background:black;
color:white;
display:none;
flex-direction:column;
align-items:center;
justify-content:center;
z-index:150;
}

#loadingBarContainer {
width:400px;
height:20px;
background:#333;
margin-top:20px;
}

#loadingBar {
width:0%;
height:100%;
background:white;
}

/* ===== GAME UI ===== */
#ui {
position:absolute;
bottom:20px;
left:20px;
color:white;
font-size:14px;
opacity:0.8;
display:none;
}

#prompt {
position:absolute;
top:20px;
left:50%;
transform:translateX(-50%);
color:white;
font-size:18px;
}
</style>
</head>
<body>

<!-- TITLE -->
<div id="titleScreen">
<h1>PROJECT PLAYCARE</h1>
<button id="startBtn">Start Game</button>
</div>

<!-- LOADING -->
<div id="loadingScreen">
<h2>Loading...</h2>
<div id="loadingBarContainer">
<div id="loadingBar"></div>
</div>
</div>

<div id="ui">
WASD Move | Shift Sprint | Space Jump | E Interact
</div>

<div id="prompt"></div>

<!-- MUSIC -->
<audio id="titleMusic" src="Title music.mp3" loop></audio>
<audio id="bgm1" src="Bgm-1.mp3" loop></audio>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>

/* ================= TITLE LOGIC ================= */

const titleScreen = document.getElementById("titleScreen");
const loadingScreen = document.getElementById("loadingScreen");
const startBtn = document.getElementById("startBtn");
const loadingBar = document.getElementById("loadingBar");
const ui = document.getElementById("ui");

const titleMusic = document.getElementById("titleMusic");
const bgm1 = document.getElementById("bgm1");

titleMusic.volume = 0.6;
bgm1.volume = 0.5;

/* Autoplay after interaction */
startBtn.addEventListener("click", () => {

titleMusic.play();

titleScreen.style.display = "none";
loadingScreen.style.display = "flex";

let progress = 0;

let loadInterval = setInterval(() => {
progress += Math.random() * 15;
if(progress >= 100){
progress = 100;
clearInterval(loadInterval);

setTimeout(()=>{
loadingScreen.style.display = "none";
initGame();
},500);
}

loadingBar.style.width = progress + "%";

},200);

});

/* ================= GAME SETUP ================= */

let scene, camera, renderer;
let player;
let colliders = [];
let door;
let doorOpen = false;

function initGame(){

bgm1.play();
ui.style.display = "block";

scene = new THREE.Scene();
scene.background = new THREE.Color(0x2c2f36);

camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);

renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* LIGHT */
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const light = new THREE.PointLight(0xffffff,1,100);
light.position.set(0,8,-10);
scene.add(light);

/* FLOOR */
const floor = new THREE.Mesh(
new THREE.PlaneGeometry(300,300),
new THREE.MeshStandardMaterial({color:0x555555})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

/* COLLISION SYSTEM */
function addCollider(mesh){
mesh.geometry.computeBoundingBox();
mesh.userData.box = new THREE.Box3().setFromObject(mesh);
colliders.push(mesh);
}

function checkCollision(position){
const playerBox = new THREE.Box3().setFromCenterAndSize(
position,
new THREE.Vector3(1.2,3,1.2)
);
for(let obj of colliders){
obj.userData.box.setFromObject(obj);
if(playerBox.intersectsBox(obj.userData.box)){
return true;
}
}
return false;
}

function wall(x,y,z,w,h,d,color=0x999999){
const mesh = new THREE.Mesh(
new THREE.BoxGeometry(w,h,d),
new THREE.MeshStandardMaterial({color})
);
mesh.position.set(x,y,z);
scene.add(mesh);
addCollider(mesh);
return mesh;
}

/* SPAWN ROOM */
wall(0,5,5,20,10,1);
wall(-10,5,-5,1,10,20);
wall(10,5,-5,1,10,20);
wall(-6,5,-15,8,10,1);
wall(6,5,-15,8,10,1);
wall(0,9,-15,4,2,1);

/* DOOR */
door = new THREE.Mesh(
new THREE.BoxGeometry(4,8,0.8),
new THREE.MeshStandardMaterial({color:0x3333aa})
);
door.position.set(0,4,-15);
scene.add(door);
addCollider(door);

/* HALLWAY */
wall(-4,5,-35,1,10,40,0x777777);
wall(4,5,-35,1,10,40,0x777777);
wall(0,10,-35,8,1,40,0x777777);

/* PLAYER */
player = new THREE.Object3D();
player.position.set(0,2,0);
scene.add(player);
player.add(camera);

let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();

let moveSpeed=5;
let sprintSpeed=8;
let gravity=25;
let jumpForce=10;
let canJump=false;
let keys={};

document.addEventListener("keydown", e=>{
keys[e.code]=true;
if(e.code==="KeyE") interact();
});
document.addEventListener("keyup", e=>keys[e.code]=false);

function interact(){
if(!doorOpen && player.position.distanceTo(door.position)<4){
doorOpen=true;
scene.remove(door);
colliders.splice(colliders.indexOf(door),1);
}
}

/* POINTER LOCK */
renderer.domElement.requestPointerLock();
document.addEventListener("mousemove",(event)=>{
if(document.pointerLockElement===renderer.domElement){
player.rotation.y -= event.movementX*0.002;
camera.rotation.x -= event.movementY*0.002;
camera.rotation.x = Math.max(-Math.PI/2,Math.min(Math.PI/2,camera.rotation.x));
}
});

/* GAME LOOP */
let prevTime=performance.now();
function animate(){
requestAnimationFrame(animate);

let time=performance.now();
let delta=(time-prevTime)/1000;
prevTime=time;

direction.set(0,0,0);
if(keys["KeyW"]) direction.z-=1;
if(keys["KeyS"]) direction.z+=1;
if(keys["KeyA"]) direction.x-=1;
if(keys["KeyD"]) direction.x+=1;
direction.normalize();

let speed=(keys["ShiftLeft"]||keys["ShiftRight"])?sprintSpeed:moveSpeed;

let newPos = player.position.clone();

newPos.x += direction.x*speed*delta;
if(!checkCollision(newPos)) player.position.x = newPos.x;

newPos = player.position.clone();
newPos.z += direction.z*speed*delta;
if(!checkCollision(newPos)) player.position.z = newPos.z;

velocity.y -= gravity*delta;
if(keys["Space"] && canJump){
velocity.y = jumpForce;
canJump=false;
}
player.position.y += velocity.y*delta;
if(player.position.y<2){
player.position.y=2;
velocity.y=0;
canJump=true;
}

renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

}

</script>
</body>
</html>
