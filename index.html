<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PROJECT: PLAYCARE</title>
<style>
body{
  margin:0;
  overflow:hidden;
  background:#02030a;
  font-family:Arial, system-ui, sans-serif;
  color:white;
}

/* TITLE SCREEN */
#titleScreen{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at 50% 20%, #181824 0, #050611 55%, #000 100%);
  z-index:20;
}
#titleLogo{
  font-size:54px;
  letter-spacing:6px;
  margin:0;
  text-transform:uppercase;
  text-align:center;
}
#titleLogo span{
  display:block;
}
#titleLogo span:nth-child(1){
  font-size:18px;
  letter-spacing:8px;
  color:#ff4a4a;
}
#titleLogo span:nth-child(2){
  margin-top:6px;
}
#titleSubtitle{
  margin-top:4px;
  font-size:14px;
  opacity:.75;
  text-align:center;
  animation:subtitlePulse 2.4s ease-in-out infinite;
}
@keyframes subtitlePulse{
  0%,100%{opacity:.4;}
  50%{opacity:1;}
}
#titleButtons{
  margin-top:30px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.titleBtn{
  padding:10px 30px;
  font-size:16px;
  letter-spacing:2px;
  text-transform:uppercase;
  border:none;
  border-radius:4px;
  cursor:pointer;
  background:#ff2222;
  color:white;
  transition:background .15s, transform .1s, box-shadow .15s;
}
.titleBtn:hover{
  background:#ff4444;
  transform:translateY(-1px);
  box-shadow:0 0 12px rgba(255,60,60,0.5);
}

/* SETTINGS PANEL */
#settingsPanel{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:320px;
  padding:16px 18px;
  background:rgba(0,0,0,0.88);
  border:1px solid #444;
  box-shadow:0 0 18px rgba(0,0,0,0.8);
  display:none;
  z-index:25;
}
#settingsPanel h2{
  margin:0 0 10px 0;
  font-size:18px;
  letter-spacing:2px;
}
.settingRow{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:8px 0;
  font-size:13px;
}
.settingRow input[type=range]{
  width:160px;
}
.settingRow input[type=checkbox]{
  transform:scale(1.1);
}
#settingsClose{
  margin-top:12px;
  padding:6px 14px;
  font-size:13px;
  border:none;
  border-radius:4px;
  background:#444;
  color:white;
  cursor:pointer;
}
#settingsClose:hover{
  background:#666;
}

/* BASIC HUD STUBS (for when game runs) */
#hud,#info{
  position:absolute;
  left:20px;
  bottom:20px;
  color:white;
  font-size:14px;
  text-shadow:0 0 4px #000;
  z-index:5;
  white-space:pre-line;
  display:none;
}
#info{
  left:auto;
  right:20px;
  bottom:auto;
  top:20px;
  font-size:13px;
  text-align:right;
}
#crosshair{
  position:absolute;
  top:50%;left:50%;
  width:6px;height:6px;
  background:white;
  transform:translate(-50%,-50%);
  display:none;
  z-index:5;
}

/* Placeholder for canvas */
#gameCanvas{
  position:fixed;
  inset:0;
  display:block;
}
</style>
</head>
<body>

<!-- TITLE SCREEN -->
<div id="titleScreen">
  <h1 id="titleLogo">
    <span>PROJECT</span>
    <span>PLAYCARE</span>
  </h1>
  <div id="titleSubtitle">Click to begin. The factory has been waiting for you.</div>
  <div id="titleButtons">
    <button class="titleBtn" id="playBtn">Play</button>
    <button class="titleBtn" id="settingsBtn">Settings</button>
    <button class="titleBtn" id="quitBtn">Quit</button>
  </div>
</div>

<!-- SETTINGS PANEL -->
<div id="settingsPanel">
  <h2>SETTINGS</h2>
  <div class="settingRow">
    <span>Master Volume</span>
    <input id="volumeSlider" type="range" min="0" max="100" value="75">
  </div>
  <div class="settingRow">
    <span>Mouse Sensitivity</span>
    <input id="sensSlider" type="range" min="20" max="200" value="80">
  </div>
  <div class="settingRow">
    <span>Flashlight Enabled</span>
    <input id="flashToggle" type="checkbox" checked>
  </div>
  <button id="settingsClose">Back</button>
</div>

<!-- BASIC GAME HUD ELEMENTS (you wire them to your chapter logic) -->
<div id="hud"></div>
<div id="info"></div>
<div id="crosshair"></div>

<!-- AUDIO (TITLE + IN-GAME) -->
<audio id="titleMusic" src="Title music.mp3" loop></audio>
<audio id="hallMusic" src="Bgm-1.mp3" loop></audio>
<audio id="chaseMusic" src="chase music.mp3" loop></audio>
<audio id="protoMusic" src="Prototype encounter music.mp3" loop></audio>

<!-- THREE.JS + GAME SCRIPT -->
<canvas id="gameCanvas"></canvas>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
// ===== TITLE SCREEN + SETTINGS LOGIC =====
const titleScreen=document.getElementById("titleScreen");
const playBtn=document.getElementById("playBtn");
const settingsBtn=document.getElementById("settingsBtn");
const quitBtn=document.getElementById("quitBtn");

const settingsPanel=document.getElementById("settingsPanel");
const settingsClose=document.getElementById("settingsClose");
const volumeSlider=document.getElementById("volumeSlider");
const sensSlider=document.getElementById("sensSlider");
const flashToggle=document.getElementById("flashToggle");

const titleMusic=document.getElementById("titleMusic");
const hallMusic=document.getElementById("hallMusic");
const chaseMusic=document.getElementById("chaseMusic");
const protoMusic=document.getElementById("protoMusic");

const hud=document.getElementById("hud");
const info=document.getElementById("info");
const crosshair=document.getElementById("crosshair");

// global options used by the game
const options={
  masterVolume:0.75,
  mouseSensitivity:0.8/100, // scaled from slider
  flashlightEnabled:true
};

function fadeIn(audio,target=0.75,duration=1500){
  audio.volume=0;
  audio.play().catch(()=>{});
  const step=target/(duration/50);
  const id=setInterval(()=>{
    audio.volume=Math.min(target,audio.volume+step);
    if(audio.volume>=target)clearInterval(id);
  },50);
}
function fadeOut(audio,duration=1500){
  const step=(audio.volume||0)/(duration/50||1);
  const id=setInterval(()=>{
    audio.volume=Math.max(0,audio.volume-step);
    if(audio.volume<=0){audio.pause();clearInterval(id);}
  },50);
}
function stopAllMusic(){
  [titleMusic,hallMusic,chaseMusic,protoMusic].forEach(a=>{a.pause();a.currentTime=0;});
}

// Apply master volume
function applyMasterVolume(){
  const tracks=[titleMusic,hallMusic,chaseMusic,protoMusic];
  tracks.forEach(a=>{
    a.volume=options.masterVolume;
  });
}
volumeSlider.addEventListener("input",()=>{
  options.masterVolume=Number(volumeSlider.value)/100;
  applyMasterVolume();
});

// Mouse sensitivity (used by game camera)
sensSlider.addEventListener("input",()=>{
  options.mouseSensitivity=Number(sensSlider.value)/1000; // e.g. 0.02–0.2
});

// Flashlight toggle
flashToggle.addEventListener("change",()=>{
  options.flashlightEnabled=flashToggle.checked;
  if(window.gameFlashlight){
    gameFlashlight.visible=options.flashlightEnabled;
  }
});

// Settings open/close
settingsBtn.onclick=()=>{
  settingsPanel.style.display="block";
};
settingsClose.onclick=()=>{
  settingsPanel.style.display="none";
};
quitBtn.onclick=()=>{
  // For web, "Quit" just hides title – nothing else to do.
  titleScreen.style.display="none";
};

// Start title music
applyMasterVolume();
fadeIn(titleMusic,options.masterVolume);

// When PLAY is clicked, fade out title music and start the game
playBtn.onclick=()=>{
  fadeOut(titleMusic,800);
  titleScreen.style.display="none";
  settingsPanel.style.display="none";
  startGame();
};

// ===== THREE.JS GAME BOOTSTRAP (STUB) =====
// This is where you plug in your existing Project: Playcare chapter code.
// The variable `options` gives you masterVolume, mouseSensitivity, flashlightEnabled.
// The global `gameFlashlight` is referenced for toggling.

let scene,camera,renderer,player,gameFlashlight;
let yaw=0,pitch=0;
const keys={};

function startGame(){
  // Basic scene init; replace/extend with your chapter logic
  const canvas=document.getElementById("gameCanvas");
  renderer=new THREE.WebGLRenderer({canvas,antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  renderer.setPixelRatio(window.devicePixelRatio||1);
  renderer.shadowMap.enabled=true;

  scene=new THREE.Scene();
  scene.fog=new THREE.Fog(0x111118,15,120);

  camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,2000);
  player=new THREE.Object3D();
  player.position.set(0,2,10);
  scene.add(player);
  player.add(camera);

  // Lights
  const ambient=new THREE.AmbientLight(0x404050,0.5);
  scene.add(ambient);

  gameFlashlight=new THREE.SpotLight(0xffffff,2.2,60,Math.PI/8,0.4);
  gameFlashlight.castShadow=true;
  camera.add(gameFlashlight);
  scene.add(camera);
  gameFlashlight.visible=options.flashlightEnabled;

  // Simple room
  const floorMat=new THREE.MeshStandardMaterial({color:0x181a24,roughness:0.9});
  const wallMat=new THREE.MeshStandardMaterial({color:0x202434,roughness:0.8});
  const floor=new THREE.Mesh(new THREE.BoxGeometry(20,0.2,20),floorMat);
  floor.position.set(0,0,0);
  floor.receiveShadow=true;
  scene.add(floor);

  const wallF=new THREE.Mesh(new THREE.BoxGeometry(20,6,0.2),wallMat);
  wallF.position.set(0,3,-10);
  scene.add(wallF);

  const wallB=wallF.clone();
  wallB.position.z=10;
  scene.add(wallB);

  const wallL=new THREE.Mesh(new THREE.BoxGeometry(0.2,6,20),wallMat);
  wallL.position.set(-10,3,0);
  scene.add(wallL);

  const wallR=wallL.clone();
  wallR.position.x=10;
  scene.add(wallR);

  // HUD visible once game starts
  hud.style.display="block";
  info.style.display="block";
  crosshair.style.display="block";
  hud.textContent="PROJECT: PLAYCARE\n(Prototype room)\nMove with WASD, look with mouse.";
  info.textContent="Settings: ESC → browser.\nVolume/sensitivity via Settings on title.";

  // Pointer lock + movement
  renderer.domElement.requestPointerLock=
    renderer.domElement.requestPointerLock||
    renderer.domElement.mozRequestPointerLock;
  renderer.domElement.addEventListener("click",()=>renderer.domElement.requestPointerLock());

  document.addEventListener("mousemove",(e)=>{
    if(document.pointerLockElement!==renderer.domElement)return;
    yaw-=e.movementX*options.mouseSensitivity;
    pitch-=e.movementY*options.mouseSensitivity;
    pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,pitch));
    player.rotation.y=yaw;
    camera.rotation.x=pitch;
  });

  document.addEventListener("keydown",(e)=>{keys[e.code]=true;});
  document.addEventListener("keyup",(e)=>{keys[e.code]=false;});

  window.addEventListener("resize",()=>{
    camera.aspect=window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
  });

  // Start in-game music (e.g. lobby/hall music)
  stopAllMusic();
  applyMasterVolume();
  fadeIn(hallMusic,options.masterVolume);

  animate();
}

function animate(){
  requestAnimationFrame(animate);
  if(!renderer || !scene)return;
  const dt=0.016;

  if(player){
    const forward=new THREE.Vector3();
    camera.getWorldDirection(forward);
    forward.y=0;forward.normalize();
    const right=new THREE.Vector3();
    right.crossVectors(forward,new THREE.Vector3(0,1,0)).normalize();

    let move=new THREE.Vector3();
    if(keys["KeyW"])move.add(forward);
    if(keys["KeyS"])move.sub(forward);
    if(keys["KeyA"])move.sub(right);
    if(keys["KeyD"])move.add(right);
    if(move.lengthSq()>0)move.normalize();

    player.position.addScaledVector(move,6*dt);
  }

  renderer.render(scene,camera);
}
</script>
</body>
</html>
